!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e,n){t.exports=n(1)(0)},function(t,e){t.exports=vendor_78d002047907e32b5251},function(t,e,n){t.exports=n(1)(2)},function(t,e,n){"use strict";n.r(e);var i,o=n(0);n(2);function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var s=function(){function t(e,n,i,o,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.m=e,this.n=n,this.width=i,this.thickness=o,this.wallHeight=r,this.row=[],this.col=[],this.wall=[],this.graph=[],this.initMaze(e,n,i,o,r),console.log(this.graph)}var e,n,s;return e=t,(n=[{key:"initMaze",value:function(t,e,n,r,s){this.initData(t,e);var a,h=new o.Mesh(new o.BoxGeometry(e*n,s,r),new o.MeshNormalMaterial),l=new o.Mesh(new o.BoxGeometry(e*n,s,r),new o.MeshNormalMaterial),u=new o.Mesh(new o.BoxGeometry(r,s,t*n),new o.MeshNormalMaterial),c=new o.Mesh(new o.BoxGeometry(r,s,t*n),new o.MeshNormalMaterial);for(h.position.set(e*n/2,s/2,0),l.position.set(e*n/2,s/2,t*n),u.position.set(0,s/2,t*n/2),c.position.set(e*n,s/2,t*n/2),i.add(h,l,u,c),this.wall.push(h,l,u,c),a=0;a<t*e;a++){var d=new Array(4);d.fill(null),a-e>=0&&(d[0]=a-e),a%e!=0&&(d[1]=a-1),a+e<t*e&&(d[2]=a+e),(a+1)%e!=0&&(d[3]=a+1),this.graph.push(d)}for(a=0;a<this.row.length;a++){var p=new o.Mesh(new o.BoxGeometry(n,s,r),new o.MeshNormalMaterial);p.position.x=this.row[a][1]*n,p.position.z=this.row[a][0]*n+n/2,p.position.y=s/2,p.rotation.y=Math.PI/2;var f=this.row[a][1]-1+e*this.row[a][0],w=this.row[a][1]+e*this.row[a][0];p.mazeData={isRow:!0,frontPoint:f,nextPoint:w},this.wall.push(p),i.add(p),this.graph[f][this.graph[f].indexOf(w)]=null,this.graph[w][this.graph[w].indexOf(f)]=null}for(a=0;a<this.col.length;a++){var y=new o.Mesh(new o.BoxGeometry(n,s,r),new o.MeshNormalMaterial);y.position.z=this.col[a][1]*n,y.position.x=this.col[a][0]*n+n/2,y.position.y=s/2;var v=(this.col[a][1]-1)*e+this.col[a][0],m=this.col[a][1]*e+this.col[a][0];y.mazeData={isRow:!1,frontPoint:v,nextPoint:m},this.wall.push(y),i.add(y),this.graph[v][this.graph[v].indexOf(m)]=null,this.graph[m][this.graph[m].indexOf(v)]=null}}},{key:"initData",value:function(t,e){for(var n=[],i=[],o=0;o<t*e;o++)n.push(o);for(var r=0;r<t;r++)for(var s=1;s<e;s++)i.push([0,r,s]);for(var a=0;a<e;a++)for(var h=1;h<t;h++)i.push([1,a,h]);for(;i.length>0;){var l=Math.floor(i.length*Math.random()),u=void 0,c=void 0;0===i[l][0]?(u=i[l][1]*e+i[l][2]-1,c=i[l][1]*e+i[l][2]):(u=(i[l][2]-1)*e+i[l][1],c=i[l][2]*e+i[l][1]),-1!==n[u]&&-1!==n[c]&&p(u,c)||(0===i[l][0]?this.row.push([i[l][1],i[l][2]]):this.col.push([i[l][1],i[l][2]]));var d=i[l];i[l]=i[i.length-1],i[i.length-1]=d,i.pop()}function p(t,e){var i=f(t),o=f(e);return i!==o&&(n[o]=i,!0)}function f(t){return t==n[t]?t:n[t]=f(n[t])}}},{key:"removeWall",value:function(t){var e=t.frontPoint,n=t.nextPoint,i=Math.floor(e/this.n),o=e%this.n+1;if(n-e==1){var r;for(r=0;r<this.row.length&&(this.row[r][0]!==i||this.row[r][1]!==o);r++);this.row.splice(r,1)}else{var s;for(s=0;s<this.col.length&&(this.col[s][0]!==i||this.col[s][1]!==o);s++);this.col.splice(s,1)}return this.pushInGraph(e,n),void this.pushInGraph(n,e)}},{key:"check",value:function(t,e){return!(this.graph[t].indexOf(e)<0)}},{key:"getNodeToPos",value:function(t){var e=t%this.n*this.width+this.width/2,n=Math.floor(t/this.n)*this.width+this.width/2;return new o.Vector3(e,0,n)}},{key:"pushInGraph",value:function(t,e){t-this.n===e?this.graph[t][0]=e:t-1===e?this.graph[t][1]=e:t+this.n===e?this.graph[t][2]=e:t+1===e?this.graph[t][3]=e:console.log("pushInGraph function Error!!!")}}])&&r(e.prototype,n),s&&r(e,s),t}(),a=function t(){document.addEventListener("keydown",t.onKeyDown,!1),document.addEventListener("keyup",t.onKeyUp,!1)};a.k={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",219:"[",220:"\\",221:"]",222:"'"},a.status={},a.keyName=function(t){return null!=a.k[t]?a.k[t]:String.fromCharCode(t)},a.onKeyUp=function(t){t.preventDefault();var e=a.keyName(t.keyCode);a.status[e]&&(a.status[e].pressed=!1)},a.onKeyDown=function(t){t.preventDefault();var e=a.keyName(t.keyCode);a.status[e]||(a.status[e]={down:!1,pressed:!1,up:!1,updatedPreviously:!1})},a.prototype.update=function(){for(var t in a.status)a.status[t].updatedPreviously?a.status[t].down=!1:(a.status[t].down=!0,a.status[t].pressed=!0,a.status[t].updatedPreviously=!0),a.status[t].up?delete a.status[t]:a.status[t].pressed||(a.status[t].up=!0)},a.prototype.down=function(t){return a.status[t]&&a.status[t].down},a.prototype.pressed=function(t){return a.status[t]&&a.status[t].pressed},a.prototype.up=function(t){return a.status[t]&&a.status[t].up},a.prototype.debug=function(){var t="Keys active: ";for(var e in a.status)t+=" "+e;console.log(t)};var h=a;function l(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var u=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.nowCell=r,this.width=10,this.body=this.buildBody(n),this.maze=e,this.rot=0,this.speed=0,s&&(s.position.set(-40,60,0),s.lookAt(this.body.position.clone().add(new o.Vector3(-5,100,0)).sub(s.position)),this.body.add(s)),this.body.position.copy(this.maze.getNodeToPos(r)),i.add(this.body)}var e,n,r;return e=t,(n=[{key:"buildBody",value:function(t){var e=new o.Object3D,n=new o.Mesh(new o.CylinderGeometry(this.width,this.width,10,64),new o.MeshBasicMaterial({color:new o.Color(t)})),i=new o.Mesh(new o.BoxGeometry(2*this.width,10,6),new o.MeshBasicMaterial({color:new o.Color(t)}));return i.position.set(this.width,0,0),n.add(i),n.position.y=5,e.add(n),e}},{key:"update",value:function(t,e){e.update(),e.pressed("right")&&(this.rot-=.03),e.pressed("left")&&(this.rot+=.03),e.pressed("up")&&(this.speed+=.2),e.pressed("down")&&(this.speed-=.2);var n=new o.Vector3(this.speed,0,0);n.applyAxisAngle(new o.Vector3(0,1,0),this.rot),this.body.rotation.y=this.rot;var i=this.body.position.clone().add(n.clone().multiplyScalar(t));if(this.checkNextPos(i)){this.body.position.add(n.clone().multiplyScalar(t));var r=Math.floor(i.x/this.maze.width),s=Math.floor(i.z/this.maze.width);this.nowCell=s*this.maze.n+r}else this.speed/=2}},{key:"checkNextPos",value:function(t){var e=this.maze.width*this.maze.n,n=this.maze.width*this.maze.m;if(t.x>=0+this.width&&t.z>=0+this.width&&t.x<=e-this.width&&t.z<=n-this.width){for(var i=[[1,1],[-1,1],[1,-1],[-1,-1]],o=0;o<4;o++){var r=Math.floor((t.x+i[o][0]*this.width)/this.maze.width),s=Math.floor((t.z+i[o][1]*this.width)/this.maze.width)*this.maze.n+r;if(s!==this.nowCell&&!this.maze.check(s,this.nowCell))return!1}return!0}return!1}}])&&l(e.prototype,n),r&&l(e,r),t}();function c(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var d=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.initHUD(),e.add(this.cameraHUD2)}var e,n,i;return e=t,(n=[{key:"initHUD",value:function(){this.sceneHUD=new o.Scene,this.cameraHUD1=new o.OrthographicCamera(-10.1,10.1,10.1,-10.1,1,50),this.cameraHUD2=new o.OrthographicCamera(-250,250,250,-250,-350,350),this.cameraHUD2.position.set(0,15,0),this.cameraHUD2.up.set(1,0,0),this.cameraHUD2.lookAt(new o.Vector3);var t=new o.Geometry;t.vertices.push(new o.Vector3(-10,-10,0),new o.Vector3(10,-10,0),new o.Vector3(10,10,0),new o.Vector3(-10,10,0),new o.Vector3(-10,-10,0));var e=new o.Line(t,new o.LineBasicMaterial({color:16777215}));this.sceneHUD.add(e)}}])&&c(e.prototype,n),i&&c(e,i),t}();function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function w(t,e){return!e||"object"!==p(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function v(t,e){return(v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var m,g,b,P,C,M,N,x,k=function(t){function e(t,n){var i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=w(this,y(e).call(this,t,n,r,a))).NPCStateTable=Object.freeze({initState:1,findNextPoint:2,GoToPoint:3}),i.NPCState=i.NPCStateTable.initState,i.isTraverse=new Array(t.m*t.n),i.targetNode=new o.Vector3,i.target=0,i.stackPath=[],i.frontNode=-1,i.speed=60,i.traversMode=s,i.traversModeTable=Object.freeze({left:0,right:1,random:2}),i}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&v(t,e)}(e,u),n=e,(i=[{key:"findNextPoint_Random",value:function(){this.isTraverse[this.nowCell]=!0;for(var t,e=!1,n=0;n<this.maze.graph[this.nowCell].length;n++)if(null!==this.maze.graph[this.nowCell][n]&&!this.isTraverse[this.maze.graph[this.nowCell][n]]){this.stackPath.push(this.nowCell),t=this.maze.graph[this.nowCell][n],e=!0;break}return!(!e&&0==this.stackPath.length)&&(e||(t=this.stackPath[this.stackPath.length-1],this.stackPath.pop()),this.target=t,this.targetNode.copy(this.maze.getNodeToPos(t)),!0)}},{key:"findNextPoint_Left",value:function(){var t;t=(this.maze.graph[this.nowCell].indexOf(this.frontNode)+3)%4;for(var e=0;e<4&&null===this.maze.graph[this.nowCell][t];e++,t=(t+3)%4);return this.frontNode=this.nowCell,this.target=this.maze.graph[this.nowCell][t],this.targetNode.copy(this.maze.getNodeToPos(this.target)),!0}},{key:"findNextPoint_Right",value:function(){var t;t=(this.maze.graph[this.nowCell].indexOf(this.frontNode)+1)%4;for(var e=0;e<4&&null===this.maze.graph[this.nowCell][t];e++,t=(t+1)%4);return this.frontNode=this.nowCell,this.target=this.maze.graph[this.nowCell][t],this.targetNode.copy(this.maze.getNodeToPos(this.target)),!0}},{key:"GoToPoint",value:function(t){var e=this.targetNode.clone().sub(this.body.position).normalize().multiplyScalar(t*this.speed);return this.body.position.add(e),this.body.rotation.y=Math.acos(e.x/e.length()),e.z>0&&(this.body.rotation.y*=-1),this.targetNode.clone().sub(this.body.position).length()<3&&(this.nowCell=this.target,!0)}},{key:"update",value:function(t){var e;switch(this.NPCState){case this.NPCStateTable.initState:this.isTraverse.fill(!1),this.isTraverse[this.nowCell]=!0,this.NPCState=this.NPCStateTable.findNextPoint;case this.NPCStateTable.findNextPoint:switch(this.traversMode){case this.traversModeTable.left:e=this.findNextPoint_Left();break;case this.traversModeTable.right:e=this.findNextPoint_Right()}if(!e){this.NPCState=this.NPCStateTable.initState;break}this.NPCState=this.NPCStateTable.GoToPoint;case this.NPCStateTable.GoToPoint:(e=this.GoToPoint(t))&&(this.NPCState=this.NPCStateTable.findNextPoint)}}}])&&f(n.prototype,i),r&&f(n,r),e}(),z=new o.Raycaster,S=new o.Vector2,T=[],O=new h;window.addEventListener("resize",function(){var t=window.innerWidth,e=window.innerHeight;m.aspect=t/e,m.updateProjectionMatrix(),g.setSize(t,e)},!1),document.addEventListener("mousedown",function(t){t.preventDefault(),S.x=t.clientX/window.innerWidth*2-1,S.y=-t.clientY/window.innerHeight*2+1,z.setFromCamera(S,m);var e=z.intersectObjects(T);e.length>0&&(console.log(e[0]),"mazeData"in e[0].object&&(i.remove(e[0].object),P.removeWall(e[0].object.mazeData)))},!1),function(){i=new o.Scene,b=new o.Clock,m=new o.PerspectiveCamera(70,window.innerWidth/window.innerHeight,10,1e4),i.add(m),new o.GridHelper(500,10,"red","white").position.set(250,0,250),i.add(new o.AxisHelper(50)),(g=new o.WebGLRenderer).setSize(window.innerWidth,window.innerHeight),g.setClearColor(8947848),g.autoClear=!1,document.body.appendChild(g.domElement),(P=new s(5,5,50,5,50)).wall.forEach(function(t){T.push(t)}),M=new u(P,"green",0,m),C=new d(M.body);var t=new o.Mesh(new o.CylinderGeometry(15,15,100,64),new o.MeshBasicMaterial({color:255}));t.position.set(475,50,475),i.add(t);var e=new o.Mesh(new o.PlaneGeometry(500,500),new o.MeshBasicMaterial({color:13007164}));e.rotation.x=-Math.PI/2,e.position.set(250,0,250),i.add(e),N=new k(P,"red",5,0),x=new k(P,"blue",13,1)}(),function t(){var e=b.getDelta();M.update(e,O);x.update(e);N.update(e);requestAnimationFrame(t);n=window.innerWidth,o=window.innerHeight,g.setScissorTest(!0),g.setViewport(0,0,n,o),g.setScissor(0,0,n,o),g.clear(),g.render(i,m),g.setViewport(.7*n,0,.3*n,.3*o),g.setScissor(.7*n,0,.3*n,.3*o),g.clear(),g.render(i,C.cameraHUD2),g.render(C.sceneHUD,C.cameraHUD1);var n,o}()}]);
//# sourceMappingURL=main.bundle.js.map