!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e,i){t.exports=i(1)(0)},function(t,e){t.exports=vendor_78d002047907e32b5251},function(t,e,i){t.exports=i(1)(2)},function(t,e,i){"use strict";i.r(e);var n,o=i(0);i(2);function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=function(){function t(e,i,n,o,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.m=e,this.n=i,this.width=n,this.thickness=o,this.wallHeight=r,this.row=[],this.col=[],this.wall=[],this.graph=[],this.initMaze(e,i,n,o,r),console.log(this.graph)}var e,i,s;return e=t,(i=[{key:"initMaze",value:function(t,e,i,r,s){this.initData(t,e);var a,h=new o.Mesh(new o.BoxGeometry(e*i,s,r),new o.MeshNormalMaterial),l=new o.Mesh(new o.BoxGeometry(e*i,s,r),new o.MeshNormalMaterial),u=new o.Mesh(new o.BoxGeometry(r,s,t*i),new o.MeshNormalMaterial),c=new o.Mesh(new o.BoxGeometry(r,s,t*i),new o.MeshNormalMaterial);for(h.position.set(e*i/2,s/2,0),l.position.set(e*i/2,s/2,t*i),u.position.set(0,s/2,t*i/2),c.position.set(e*i,s/2,t*i/2),n.add(h,l,u,c),this.wall.push(h,l,u,c),a=0;a<t*e;a++){var d=[];a-e>=0&&d.push(a-e),a%e!=0&&d.push(a-1),(a+1)%e!=0&&d.push(a+1),a+e<t*e&&d.push(a+e),this.graph.push(d)}for(a=0;a<this.row.length;a++){var p=new o.Mesh(new o.BoxGeometry(i,s,r),new o.MeshNormalMaterial);p.position.x=this.row[a][1]*i,p.position.z=this.row[a][0]*i+i/2,p.position.y=s/2,p.rotation.y=Math.PI/2;var f=this.row[a][1]-1+e*this.row[a][0],w=this.row[a][1]+e*this.row[a][0];p.mazeData={isRow:!0,frontPoint:f,nextPoint:w},this.wall.push(p),n.add(p),this.graph[f].splice(this.graph[f].indexOf(w),1),this.graph[w].splice(this.graph[w].indexOf(f),1)}for(a=0;a<this.col.length;a++){var y=new o.Mesh(new o.BoxGeometry(i,s,r),new o.MeshNormalMaterial);y.position.z=this.col[a][1]*i,y.position.x=this.col[a][0]*i+i/2,y.position.y=s/2;var v=(this.col[a][1]-1)*e+this.col[a][0],m=this.col[a][1]*e+this.col[a][0];y.mazeData={isRow:!1,frontPoint:v,nextPoint:m},this.wall.push(y),n.add(y),this.graph[v].splice(this.graph[v].indexOf(m),1),this.graph[m].splice(this.graph[m].indexOf(v),1)}}},{key:"initData",value:function(t,e){for(var i=[],n=[],o=0;o<t*e;o++)i.push(o);for(var r=0;r<t;r++)for(var s=1;s<e;s++)n.push([0,r,s]);for(var a=0;a<e;a++)for(var h=1;h<t;h++)n.push([1,a,h]);for(;n.length>0;){var l=Math.floor(n.length*Math.random()),u=void 0,c=void 0;0===n[l][0]?(u=n[l][1]*e+n[l][2]-1,c=n[l][1]*e+n[l][2]):(u=(n[l][2]-1)*e+n[l][1],c=n[l][2]*e+n[l][1]),-1!==i[u]&&-1!==i[c]&&p(u,c)||(0===n[l][0]?this.row.push([n[l][1],n[l][2]]):this.col.push([n[l][1],n[l][2]]));var d=n[l];n[l]=n[n.length-1],n[n.length-1]=d,n.pop()}function p(t,e){var n=f(t),o=f(e);return n!==o&&(i[o]=n,!0)}function f(t){return t==i[t]?t:i[t]=f(i[t])}}},{key:"removeWall",value:function(t){var e=t.frontPoint,i=t.nextPoint,r=Math.floor(e/this.n),s=e%this.n+1;if(i-e==1){var a;for(a=0;a<this.row.length&&(this.row[a][0]!==r||this.row[a][1]!==s);a++);this.row.splice(a,1)}else{var h;for(h=0;h<this.col.length&&(this.col[h][0]!==r||this.col[h][1]!==s);h++);this.col.splice(h,1)}this.graph[e].push(i),this.graph[i].push(e);for(var l=e,u=[],c=0;c<this.graph[e].length;c++){var d=b(this.graph,e,this.graph[e][c]);if(-1!==d){u.push(d);break}}var p=Math.floor(u.length*Math.random());if(p+1===u.length?(e=u[p],i=u[0]):(e=u[p],i=u[p+1]),e>i){var f=e;e=i,i=f}this.graph[e].splice(this.graph[e].indexOf(i),1),this.graph[i].splice(this.graph[i].indexOf(e),1);var w=new o.Mesh(new o.BoxGeometry(this.width,this.wallHeight,this.thickness),new o.MeshNormalMaterial);if(i-e==1){var y=Math.floor(e/this.n),v=e%this.n+1;this.row.push([y,v]),w.position.x=v*this.width,w.position.z=y*this.width+this.width/2,w.position.y=this.wallHeight/2,w.rotation.y=Math.PI/2,w.mazeData={isRow:!0,frontPoint:e,nextPoint:i}}else{var m=e%this.n,g=Math.floor(e/this.n)+1;this.col.push([m,g]),w.position.z=g*this.width,w.position.x=m*this.width+this.width/2,w.position.y=this.wallHeight/2,w.mazeData={isRow:!1,frontPoint:e,nextPoint:i}}function b(t,e,i){if(i===l)return i;for(var n=0;n<t[i].length;n++)if(t[i][n]!==e){var o=b(t,i,t[i][n]);if(-1!==o)return u.push(o),i}return-1}n.add(w),this.wall.push(w)}},{key:"check",value:function(t,e){return!(this.graph[t].indexOf(e)<0)}},{key:"getNodeToPos",value:function(t){var e=t%this.n*this.width+this.width/2,i=Math.floor(t/this.n)*this.width+this.width/2;return new o.Vector3(e,0,i)}}])&&r(e.prototype,i),s&&r(e,s),t}(),a=function t(){document.addEventListener("keydown",t.onKeyDown,!1),document.addEventListener("keyup",t.onKeyUp,!1)};a.k={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",219:"[",220:"\\",221:"]",222:"'"},a.status={},a.keyName=function(t){return null!=a.k[t]?a.k[t]:String.fromCharCode(t)},a.onKeyUp=function(t){t.preventDefault();var e=a.keyName(t.keyCode);a.status[e]&&(a.status[e].pressed=!1)},a.onKeyDown=function(t){t.preventDefault();var e=a.keyName(t.keyCode);a.status[e]||(a.status[e]={down:!1,pressed:!1,up:!1,updatedPreviously:!1})},a.prototype.update=function(){for(var t in a.status)a.status[t].updatedPreviously?a.status[t].down=!1:(a.status[t].down=!0,a.status[t].pressed=!0,a.status[t].updatedPreviously=!0),a.status[t].up?delete a.status[t]:a.status[t].pressed||(a.status[t].up=!0)},a.prototype.down=function(t){return a.status[t]&&a.status[t].down},a.prototype.pressed=function(t){return a.status[t]&&a.status[t].pressed},a.prototype.up=function(t){return a.status[t]&&a.status[t].up},a.prototype.debug=function(){var t="Keys active: ";for(var e in a.status)t+=" "+e;console.log(t)};var h=a;function l(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var u=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.nowCell=r,this.width=10,this.body=this.buildBody(),this.maze=e,this.rot=0,this.speed=0,i&&(i.position.set(-40,60,0),i.lookAt(this.body.position.clone().add(new o.Vector3(-5,100,0)).sub(i.position)),this.body.add(i)),this.body.position.copy(this.maze.getNodeToPos(r)),n.add(this.body)}var e,i,r;return e=t,(i=[{key:"buildBody",value:function(){var t=new o.Object3D,e=new o.Mesh(new o.CylinderGeometry(this.width,this.width,10,64),new o.MeshNormalMaterial),i=new o.Mesh(new o.BoxGeometry(2*this.width,10,6),new o.MeshNormalMaterial);return i.position.set(this.width,0,0),e.add(i),e.position.y=5,t.add(e),t}},{key:"update",value:function(t,e){e.update(),e.pressed("right")&&(this.rot-=.03),e.pressed("left")&&(this.rot+=.03),e.pressed("up")&&(this.speed+=.2),e.pressed("down")&&(this.speed-=.2);var i=new o.Vector3(this.speed,0,0);i.applyAxisAngle(new o.Vector3(0,1,0),this.rot),this.body.rotation.y=this.rot;var n=this.body.position.clone().add(i.clone().multiplyScalar(t));if(this.checkNextPos(n)){this.body.position.add(i.clone().multiplyScalar(t));var r=Math.floor(n.x/this.maze.width),s=Math.floor(n.z/this.maze.width);this.nowCell=s*this.maze.n+r}else this.speed/=2}},{key:"checkNextPos",value:function(t){var e=this.maze.width*this.maze.n,i=this.maze.width*this.maze.m;if(t.x>=0+this.width&&t.z>=0+this.width&&t.x<=e-this.width&&t.z<=i-this.width){for(var n=[[1,1],[-1,1],[1,-1],[-1,-1]],o=0;o<4;o++){var r=Math.floor((t.x+n[o][0]*this.width)/this.maze.width),s=Math.floor((t.z+n[o][1]*this.width)/this.maze.width)*this.maze.n+r;if(s!==this.nowCell&&!this.maze.check(s,this.nowCell))return!1}return!0}return!1}}])&&l(e.prototype,i),r&&l(e,r),t}();function c(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var d=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.initHUD(),e.add(this.cameraHUD2)}var e,i,n;return e=t,(i=[{key:"initHUD",value:function(){this.sceneHUD=new o.Scene,this.cameraHUD1=new o.OrthographicCamera(-10.1,10.1,10.1,-10.1,1,50),this.cameraHUD2=new o.OrthographicCamera(-175,175,175,-175,-350,350),this.cameraHUD2.position.set(0,15,0),this.cameraHUD2.up.set(1,0,0),this.cameraHUD2.lookAt(new o.Vector3);var t=new o.Geometry;t.vertices.push(new o.Vector3(-10,-10,0),new o.Vector3(10,-10,0),new o.Vector3(10,10,0),new o.Vector3(-10,10,0),new o.Vector3(-10,-10,0));var e=new o.Line(t,new o.LineBasicMaterial({color:16777215}));this.sceneHUD.add(e)}}])&&c(e.prototype,i),n&&c(e,n),t}();function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function w(t,e){return!e||"object"!==p(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function v(t,e){return(v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var m,g,b,P,M,x,k,C=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=w(this,y(e).call(this,t,n,r))).NPCStateTable=Object.freeze({initState:1,findNextPoint:2,GoToPoint:3}),i.NPCState=i.NPCStateTable.initState,i.isTraverse=new Array(t.m*t.n),i.targetNode=new o.Vector3,i.target=0,i.stackPath=[],i.speed=60,i}var i,n,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&v(t,e)}(e,u),i=e,(n=[{key:"findNextPoint",value:function(){this.isTraverse[this.nowCell]=!0;for(var t,e=!1,i=0;i<this.maze.graph[this.nowCell].length;i++)if(!this.isTraverse[this.maze.graph[this.nowCell][i]]){this.stackPath.push(this.nowCell),t=this.maze.graph[this.nowCell][i],e=!0;break}return!(!e&&0==this.stackPath.length)&&(e||(t=this.stackPath[this.stackPath.length-1],this.stackPath.pop()),this.target=t,this.targetNode.copy(this.maze.getNodeToPos(t)),!0)}},{key:"GoToPoint",value:function(t){var e=this.targetNode.clone().sub(this.body.position).normalize().multiplyScalar(t*this.speed);return this.body.position.add(e),this.body.rotation.y=Math.acos(e.x/e.length()),e.z>0&&(this.body.rotation.y*=-1),this.targetNode.clone().sub(this.body.position).length()<3&&(this.nowCell=this.target,!0)}},{key:"update",value:function(t){switch(this.NPCState){case this.NPCStateTable.initState:this.isTraverse.fill(!1),this.isTraverse[this.nowCell]=!0,this.NPCState=this.NPCStateTable.findNextPoint;case this.NPCStateTable.findNextPoint:if(!this.findNextPoint()){this.NPCState=this.NPCStateTable.initState;break}this.NPCState=this.NPCStateTable.GoToPoint;case this.NPCStateTable.GoToPoint:this.GoToPoint(t)&&(this.NPCState=this.NPCStateTable.findNextPoint)}}}])&&f(i.prototype,n),r&&f(i,r),e}(),N=new o.Raycaster,S=new o.Vector2,z=[],O=new h;window.addEventListener("resize",function(){var t=window.innerWidth,e=window.innerHeight;m.aspect=t/e,m.updateProjectionMatrix(),g.setSize(t,e)},!1),document.addEventListener("mousedown",function(t){t.preventDefault(),S.x=t.clientX/window.innerWidth*2-1,S.y=-t.clientY/window.innerHeight*2+1,N.setFromCamera(S,m);var e=N.intersectObjects(z);e.length>0&&(console.log(e[0]),"mazeData"in e[0].object&&(n.remove(e[0].object),P.removeWall(e[0].object.mazeData)))},!1),function(){n=new o.Scene,b=new o.Clock,m=new o.PerspectiveCamera(70,window.innerWidth/window.innerHeight,10,1e4),n.add(m),new o.GridHelper(500,10,"red","white").position.set(250,0,250),n.add(new o.AxisHelper(50)),(g=new o.WebGLRenderer).setSize(window.innerWidth,window.innerHeight),g.setClearColor(8947848),g.autoClear=!1,document.body.appendChild(g.domElement),(P=new s(5,5,50,5,50)).wall.forEach(function(t){z.push(t)}),x=new u(P,m),M=new d(x.body);var t=new o.Mesh(new o.CylinderGeometry(15,15,100,64),new o.MeshBasicMaterial({color:255}));t.position.set(475,50,475),n.add(t);var e=new o.Mesh(new o.PlaneGeometry(500,500),new o.MeshBasicMaterial({color:13007164}));e.rotation.x=-Math.PI/2,e.position.set(250,0,250),n.add(e),k=new C(P)}(),function t(){var e=b.getDelta();x.update(e,O);k.update(e);requestAnimationFrame(t);i=window.innerWidth,o=window.innerHeight,g.setScissorTest(!0),g.setViewport(0,0,i,o),g.setScissor(0,0,i,o),g.clear(),g.render(n,m),g.setViewport(.7*i,0,.3*i,.3*o),g.setScissor(.7*i,0,.3*i,.3*o),g.clear(),g.render(n,M.cameraHUD2),g.render(M.sceneHUD,M.cameraHUD1);var i,o}()}]);
//# sourceMappingURL=main.bundle.js.map