!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e,i){t.exports=i(1)(0)},function(t,e){t.exports=vendor_78d002047907e32b5251},function(t,e,i){t.exports=i(1)(2)},function(t,e,i){"use strict";i.r(e);var n,o=i(0);i(2);function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=function(){function t(e,i,n,o,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.m=e,this.n=i,this.width=n,this.thickness=o,this.wallHeight=s,this.row=[],this.col=[],this.wall=[],this.graph=[],this.initMaze(e,i,n,o,s),console.log(this.graph)}var e,i,r;return e=t,(i=[{key:"initMaze",value:function(t,e,i,s,r){this.initData(t,e);new o.Mesh(new o.BoxGeometry(i,r,s),new o.MeshNormalMaterial);var a,h=new o.Mesh(new o.BoxGeometry(e*i,r,s),new o.MeshNormalMaterial),l=new o.Mesh(new o.BoxGeometry(e*i,r,s),new o.MeshNormalMaterial),u=new o.Mesh(new o.BoxGeometry(s,r,t*i),new o.MeshNormalMaterial),d=new o.Mesh(new o.BoxGeometry(s,r,t*i),new o.MeshNormalMaterial);for(h.position.set(e*i/2,r/2,0),l.position.set(e*i/2,r/2,t*i),u.position.set(0,r/2,t*i/2),d.position.set(e*i,r/2,t*i/2),n.add(h,l,u,d),this.wall.push(h,l,u,d),a=0;a<t*e;a++){var p=[];a-e>=0&&p.push(a-e),a%e!=0&&p.push(a-1),(a+1)%e!=0&&p.push(a+1),a+e<t*e&&p.push(a+e),this.graph.push(p)}for(a=0;a<this.row.length;a++){var w=new o.Mesh(new o.BoxGeometry(i,r,s),new o.MeshNormalMaterial);w.position.x=this.row[a][1]*i,w.position.z=this.row[a][0]*i+i/2,w.position.y=r/2,w.rotation.y=Math.PI/2;var c=this.row[a][1]-1+e*this.row[a][0],f=this.row[a][1]+e*this.row[a][0];w.mazeData={isRow:!0,frontPoint:c,nextPoint:f},this.wall.push(w),n.add(w),this.graph[c].splice(this.graph[c].indexOf(f),1),this.graph[f].splice(this.graph[f].indexOf(c),1)}for(a=0;a<this.col.length;a++){var v=new o.Mesh(new o.BoxGeometry(i,r,s),new o.MeshNormalMaterial);v.position.z=this.col[a][1]*i,v.position.x=this.col[a][0]*i+i/2,v.position.y=r/2;var y=(this.col[a][1]-1)*e+this.col[a][0],m=this.col[a][1]*e+this.col[a][0];v.mazeData={isRow:!1,frontPoint:y,nextPoint:m},this.wall.push(v),n.add(v),this.graph[y].splice(this.graph[y].indexOf(m),1),this.graph[m].splice(this.graph[m].indexOf(y),1)}}},{key:"initData",value:function(t,e){for(var i=[],n=[],o=0;o<t*e;o++)i.push(o);for(var s=0;s<t;s++)for(var r=1;r<e;r++)n.push([0,s,r]);for(var a=0;a<e;a++)for(var h=1;h<t;h++)n.push([1,a,h]);for(;n.length>0;){var l=Math.floor(n.length*Math.random()),u=void 0,d=void 0;0===n[l][0]?(u=n[l][1]*e+n[l][2]-1,d=n[l][1]*e+n[l][2]):(u=(n[l][2]-1)*e+n[l][1],d=n[l][2]*e+n[l][1]),-1!==i[u]&&-1!==i[d]&&w(u,d)||(0===n[l][0]?this.row.push([n[l][1],n[l][2]]):this.col.push([n[l][1],n[l][2]]));var p=n[l];n[l]=n[n.length-1],n[n.length-1]=p,n.pop()}function w(t,e){var n=c(t),o=c(e);return n!==o&&(i[o]=n,!0)}function c(t){return t==i[t]?t:i[t]=c(i[t])}}},{key:"removeWall",value:function(t){var e=t.frontPoint,i=t.nextPoint,s=Math.floor(e/this.n),r=e%this.n+1;if(i-e==1){var a;for(a=0;a<this.row.length&&(this.row[a][0]!==s||this.row[a][1]!==r);a++);this.row.splice(a,1)}else{var h;for(h=0;h<this.col.length&&(this.col[h][0]!==s||this.col[h][1]!==r);h++);this.col.splice(h,1)}this.graph[e].push(i),this.graph[i].push(e);for(var l=e,u=[],d=0;d<this.graph[e].length;d++){var p=M(this.graph,e,this.graph[e][d]);if(-1!==p){u.push(p);break}}var w=Math.floor(u.length*Math.random());if(w+1===u.length?(e=u[w],i=u[0]):(e=u[w],i=u[w+1]),e>i){var c=e;e=i,i=c}this.graph[e].splice(this.graph[e].indexOf(i),1),this.graph[i].splice(this.graph[i].indexOf(e),1);var f=new o.Mesh(new o.BoxGeometry(this.width,this.wallHeight,this.thickness),new o.MeshNormalMaterial);if(i-e==1){var v=Math.floor(e/this.n),y=e%this.n+1;this.row.push([v,y]),f.position.x=y*this.width,f.position.z=v*this.width+this.width/2,f.position.y=this.wallHeight/2,f.rotation.y=Math.PI/2,f.mazeData={isRow:!0,frontPoint:e,nextPoint:i}}else{var m=e%this.n,g=Math.floor(e/this.n)+1;this.col.push([m,g]),f.position.z=g*this.width,f.position.x=m*this.width+this.width/2,f.position.y=this.wallHeight/2,f.mazeData={isRow:!1,frontPoint:e,nextPoint:i}}function M(t,e,i){if(i===l)return i;for(var n=0;n<t[i].length;n++)if(t[i][n]!==e){var o=M(t,i,t[i][n]);if(-1!==o)return u.push(o),i}return-1}n.add(f),this.wall.push(f)}},{key:"check",value:function(t,e){return!(this.graph[t].indexOf(e)<0)}}])&&s(e.prototype,i),r&&s(e,r),t}(),a=function t(){document.addEventListener("keydown",t.onKeyDown,!1),document.addEventListener("keyup",t.onKeyUp,!1)};a.k={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",219:"[",220:"\\",221:"]",222:"'"},a.status={},a.keyName=function(t){return null!=a.k[t]?a.k[t]:String.fromCharCode(t)},a.onKeyUp=function(t){t.preventDefault();var e=a.keyName(t.keyCode);a.status[e]&&(a.status[e].pressed=!1)},a.onKeyDown=function(t){t.preventDefault();var e=a.keyName(t.keyCode);a.status[e]||(a.status[e]={down:!1,pressed:!1,up:!1,updatedPreviously:!1})},a.prototype.update=function(){for(var t in a.status)a.status[t].updatedPreviously?a.status[t].down=!1:(a.status[t].down=!0,a.status[t].pressed=!0,a.status[t].updatedPreviously=!0),a.status[t].up?delete a.status[t]:a.status[t].pressed||(a.status[t].up=!0)},a.prototype.down=function(t){return a.status[t]&&a.status[t].down},a.prototype.pressed=function(t){return a.status[t]&&a.status[t].pressed},a.prototype.up=function(t){return a.status[t]&&a.status[t].up},a.prototype.debug=function(){var t="Keys active: ";for(var e in a.status)t+=" "+e;console.log(t)};var h=a;function l(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var u,d,p,w,c,f=function(){function t(e,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.nowCell=s,this.width=10,this.body=this.buildBody(),this.maze=e,this.rot=0,this.speed=0,i.position.set(-40,60,0),i.lookAt(this.body.position.clone().add(new o.Vector3(-5,100,0)).sub(i.position)),this.body.add(i),this.body.position.z=Math.floor(s/this.maze.n)*this.maze.width+this.maze.width/2,this.body.position.x=s%this.maze.n*this.maze.width+this.maze.width/2,n.add(this.body)}var e,i,s;return e=t,(i=[{key:"buildBody",value:function(){var t=new o.Object3D,e=new o.Mesh(new o.CylinderGeometry(this.width,this.width,10,64),new o.MeshNormalMaterial),i=new o.Mesh(new o.BoxGeometry(2*this.width,10,6),new o.MeshNormalMaterial);return i.position.set(this.width,0,0),e.add(i),e.position.y=5,t.add(e),t}},{key:"update",value:function(t,e){e.update(),e.pressed("right")&&(this.rot-=.03),e.pressed("left")&&(this.rot+=.03),e.pressed("up")&&(this.speed+=.2),e.pressed("down")&&(this.speed-=.2);var i=new o.Vector3(this.speed,0,0);i.applyAxisAngle(new o.Vector3(0,1,0),this.rot),this.body.rotation.y=this.rot;var n=this.body.position.clone().add(i.clone().multiplyScalar(t));if(this.checkNextPos(n)){this.body.position.add(i.clone().multiplyScalar(t));var s=Math.floor(n.x/this.maze.width),r=Math.floor(n.z/this.maze.width);this.nowCell=r*this.maze.n+s}else this.speed/=2}},{key:"checkNextPos",value:function(t){var e=this.maze.width*this.maze.n,i=this.maze.width*this.maze.m;if(t.x>=0+this.width&&t.z>=0+this.width&&t.x<=e-this.width&&t.z<=i-this.width){for(var n=[[1,1],[-1,1],[1,-1],[-1,-1]],o=0;o<4;o++){var s=Math.floor((t.x+n[o][0]*this.width)/this.maze.width),r=Math.floor((t.z+n[o][1]*this.width)/this.maze.width)*this.maze.n+s;if(r!==this.nowCell&&!this.maze.check(r,this.nowCell))return!1}return!0}return!1}}])&&l(e.prototype,i),s&&l(e,s),t}(),v=new o.Raycaster,y=new o.Vector2,m=[],g=new h;window.addEventListener("resize",function(){var t=window.innerWidth,e=window.innerHeight;u.aspect=t/e,u.updateProjectionMatrix(),d.setSize(t,e)},!1),document.addEventListener("mousedown",function(t){t.preventDefault(),y.x=t.clientX/window.innerWidth*2-1,y.y=-t.clientY/window.innerHeight*2+1,v.setFromCamera(y,u);var e=v.intersectObjects(m);e.length>0&&(console.log(e[0]),"mazeData"in e[0].object&&(n.remove(e[0].object),w.removeWall(e[0].object.mazeData)))},!1),function(){n=new o.Scene,p=new o.Clock,u=new o.PerspectiveCamera(70,window.innerWidth/window.innerHeight,10,1e4),n.add(u),new o.GridHelper(500,10,"red","white").position.set(250,0,250),n.add(new o.AxisHelper(50)),(d=new o.WebGLRenderer).setSize(window.innerWidth,window.innerHeight),d.setClearColor(8947848),document.body.appendChild(d.domElement),(w=new r(10,10,50,5,50)).wall.forEach(function(t){m.push(t)}),c=new f(w,u);var t=new o.Mesh(new o.CylinderGeometry(15,15,100,64),new o.MeshBasicMaterial({color:255}));t.position.set(475,50,475),n.add(t)}(),function t(){var e=p.getDelta();c.update(e,g);requestAnimationFrame(t);d.render(n,u)}()}]);
//# sourceMappingURL=main.bundle.js.map