!function(t){var e={};function i(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(n,a,function(e){return t[e]}.bind(null,a));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=4)}([function(t,e,i){t.exports=i(1)(0)},function(t,e){t.exports=vendor_78d002047907e32b5251},function(t,e,i){t.exports=function(){"use strict";var t=function(){var e=0,i=document.createElement("div");function n(t){return i.appendChild(t.dom),t}function a(t){for(var n=0;n<i.children.length;n++)i.children[n].style.display=n===t?"block":"none";e=t}i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(t){t.preventDefault(),a(++e%i.children.length)},!1);var o=(performance||Date).now(),r=o,s=0,h=n(new t.Panel("FPS","#0ff","#002")),l=n(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=n(new t.Panel("MB","#f08","#201"));return a(0),{REVISION:16,dom:i,addPanel:n,showPanel:a,begin:function(){o=(performance||Date).now()},end:function(){s++;var t=(performance||Date).now();if(l.update(t-o,200),r+1e3<=t&&(h.update(1e3*s/(t-r),100),r=t,s=0,c)){var e=performance.memory;c.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){o=this.end()},domElement:i,setMode:a}};return t.Panel=function(t,e,i){var n=1/0,a=0,o=Math.round,r=o(window.devicePixelRatio||1),s=80*r,h=48*r,l=3*r,c=2*r,u=3*r,p=15*r,d=74*r,f=30*r,w=document.createElement("canvas");w.width=s,w.height=h,w.style.cssText="width:80px;height:48px";var g=w.getContext("2d");return g.font="bold "+9*r+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,s,h),g.fillStyle=e,g.fillText(t,l,c),g.fillRect(u,p,d,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(u,p,d,f),{dom:w,update:function(h,v){n=Math.min(n,h),a=Math.max(a,h),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,s,p),g.fillStyle=e,g.fillText(o(h)+" "+t+" ("+o(n)+"-"+o(a)+")",l,c),g.drawImage(w,u+r,p,d-r,f,u,p,d-r,f),g.fillRect(u+d-r,p,r,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(u+d-r,p,r,o((1-h/v)*f))}}},t}()},function(t,e,i){t.exports=i(1)(2)},function(t,e,i){"use strict";i.r(e);var n,a=i(0);i(3);function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=function(){function t(e,i,n,a,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.m=e,this.n=i,this.width=n,this.thickness=a,this.wallHeight=o,this.row=[],this.col=[],this.wall=[],this.graph=[],this.initMaze(e,i,n,a,o)}var e,i,r;return e=t,(i=[{key:"initMaze",value:function(t,e,i,o,r){this.initData(t,e);var s=new a.TextureLoader;s.crossOrigin="";var h=s.load("./texture/wall/1000-1000-2.jpg"),l=s.load("./texture/wall/1000-1000-2.jpg"),c=s.load("./texture/wall/1000-1000-2.jpg"),u=s.load("./texture/wall/1000-1000-2.jpg"),p=s.load("./texture/wall/1000-1000-2.jpg");h.wrapS=h.wrapT=l.wrapS=l.wrapT=c.wrapS=c.wrapT=a.RepeatWrapping,h.repeat.set(o/r,1),l.repeat.set(e,.05),c.repeat.set(e,1),p.repeat.set(1,.05);var d=[];d.push(new a.MeshPhongMaterial({map:h}),new a.MeshPhongMaterial({map:h}),new a.MeshPhongMaterial({map:l}),new a.MeshPhongMaterial({map:l}),new a.MeshPhongMaterial({map:c}),new a.MeshPhongMaterial({map:c}));var f=[];f.push(new a.MeshPhongMaterial({map:h}),new a.MeshPhongMaterial({map:h}),new a.MeshPhongMaterial({map:p}),new a.MeshPhongMaterial({map:p}),new a.MeshPhongMaterial({map:u}),new a.MeshPhongMaterial({map:u}));var w,g=new a.Mesh(new a.BoxGeometry(e*i,r,o),d),v=new a.Mesh(new a.BoxGeometry(e*i,r,o),d),y=new a.Mesh(new a.BoxGeometry(e*i,r,o),d),m=new a.Mesh(new a.BoxGeometry(e*i,r,o),d);for(y.rotation.y=m.rotation.y=Math.PI/2,g.position.set(e*i/2,r/2,0),v.position.set(e*i/2,r/2,t*i),y.position.set(0,r/2,t*i/2),m.position.set(e*i,r/2,t*i/2),n.add(g,v,y,m),this.wall.push(g,v,y,m),w=0;w<t*e;w++){var x=new Array(4);x.fill(null),w-e>=0&&(x[0]=w-e),w%e!=0&&(x[1]=w-1),w+e<t*e&&(x[2]=w+e),(w+1)%e!=0&&(x[3]=w+1),this.graph.push(x)}for(w=0;w<this.row.length;w++){var b=new a.Mesh(new a.BoxGeometry(i,r,o),f);b.position.x=this.row[w][1]*i,b.position.z=this.row[w][0]*i+i/2,b.position.y=r/2,b.rotation.y=Math.PI/2;var P=this.row[w][1]-1+e*this.row[w][0],M=this.row[w][1]+e*this.row[w][0];b.mazeData={isRow:!0,frontPoint:P,nextPoint:M},this.wall.push(b),n.add(b),this.graph[P][this.graph[P].indexOf(M)]=null,this.graph[M][this.graph[M].indexOf(P)]=null}for(w=0;w<this.col.length;w++){var N=new a.Mesh(new a.BoxGeometry(i,r,o),f);N.position.z=this.col[w][1]*i,N.position.x=this.col[w][0]*i+i/2,N.position.y=r/2;var S=(this.col[w][1]-1)*e+this.col[w][0],T=this.col[w][1]*e+this.col[w][0];N.mazeData={isRow:!1,frontPoint:S,nextPoint:T},this.wall.push(N),n.add(N),this.graph[S][this.graph[S].indexOf(T)]=null,this.graph[T][this.graph[T].indexOf(S)]=null}this.wall.forEach(function(t){t.traverse(function(t){t instanceof a.Mesh&&(t.castShadow=t.receiveShadow=!0)})})}},{key:"initData",value:function(t,e){for(var i=[],n=[],a=0;a<t*e;a++)i.push(a);for(var o=0;o<t;o++)for(var r=1;r<e;r++)n.push([0,o,r]);for(var s=0;s<e;s++)for(var h=1;h<t;h++)n.push([1,s,h]);for(;n.length>0;){var l=Math.floor(n.length*Math.random()),c=void 0,u=void 0;0===n[l][0]?(c=n[l][1]*e+n[l][2]-1,u=n[l][1]*e+n[l][2]):(c=(n[l][2]-1)*e+n[l][1],u=n[l][2]*e+n[l][1]),-1!==i[c]&&-1!==i[u]&&d(c,u)||(0===n[l][0]?this.row.push([n[l][1],n[l][2]]):this.col.push([n[l][1],n[l][2]]));var p=n[l];n[l]=n[n.length-1],n[n.length-1]=p,n.pop()}function d(t,e){var n=f(t),a=f(e);return n!==a&&(i[a]=n,!0)}function f(t){return t==i[t]?t:i[t]=f(i[t])}}},{key:"removeWall",value:function(t){var e=t.frontPoint,i=t.nextPoint,n=Math.floor(e/this.n),a=e%this.n+1;if(i-e==1){var o;for(o=0;o<this.row.length&&(this.row[o][0]!==n||this.row[o][1]!==a);o++);this.row.splice(o,1)}else{var r;for(r=0;r<this.col.length&&(this.col[r][0]!==n||this.col[r][1]!==a);r++);this.col.splice(r,1)}return this.pushInGraph(e,i),void this.pushInGraph(i,e)}},{key:"check",value:function(t,e){return!(this.graph[t].indexOf(e)<0)}},{key:"getNodeToPos",value:function(t){var e=t%this.n*this.width+this.width/2,i=Math.floor(t/this.n)*this.width+this.width/2;return new a.Vector3(e,0,i)}},{key:"pushInGraph",value:function(t,e){t-this.n===e?this.graph[t][0]=e:t-1===e?this.graph[t][1]=e:t+this.n===e?this.graph[t][2]=e:t+1===e?this.graph[t][3]=e:console.log("pushInGraph function Error!!!")}}])&&o(e.prototype,i),r&&o(e,r),t}(),s=function t(){document.addEventListener("keydown",t.onKeyDown,!1),document.addEventListener("keyup",t.onKeyUp,!1)};s.k={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",219:"[",220:"\\",221:"]",222:"'"},s.status={},s.keyName=function(t){return null!=s.k[t]?s.k[t]:String.fromCharCode(t)},s.onKeyUp=function(t){t.preventDefault();var e=s.keyName(t.keyCode);s.status[e]&&(s.status[e].pressed=!1)},s.onKeyDown=function(t){t.preventDefault();var e=s.keyName(t.keyCode);s.status[e]||(s.status[e]={down:!1,pressed:!1,up:!1,updatedPreviously:!1})},s.prototype.update=function(){for(var t in s.status)s.status[t].updatedPreviously?s.status[t].down=!1:(s.status[t].down=!0,s.status[t].pressed=!0,s.status[t].updatedPreviously=!0),s.status[t].up?delete s.status[t]:s.status[t].pressed||(s.status[t].up=!0)},s.prototype.down=function(t){return s.status[t]&&s.status[t].down},s.prototype.pressed=function(t){return s.status[t]&&s.status[t].pressed},s.prototype.up=function(t){return s.status[t]&&s.status[t].up},s.prototype.debug=function(){var t="Keys active: ";for(var e in s.status)t+=" "+e;console.log(t)};var h=s,l=function(t){function e(n){if(i[n])return i[n].exports;var a=i[n]={exports:{},id:n,loaded:!1};return t[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){var n=i(1);e.SpriteText2D=n.SpriteText2D;var a=i(6);e.MeshText2D=a.MeshText2D;var o=i(4);e.textAlign=o.textAlign},function(t,e,i){var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},a=i(2),o=function(t){function e(){t.apply(this,arguments)}return n(e,t),e.prototype.raycast=function(){return this.sprite.raycast.apply(this.sprite,arguments)},e.prototype.updateText=function(){this.canvas.drawText(this._text,{font:this._font,fillStyle:this._fillStyle}),this.cleanUp(),this.texture=new a.Texture(this.canvas.canvas),this.texture.needsUpdate=!0,this.applyAntiAlias(),this.material?this.material.map=this.texture:this.material=new a.SpriteMaterial({map:this.texture}),this.sprite||(this.sprite=new a.Sprite(this.material),this.geometry=this.sprite.geometry,this.add(this.sprite)),this.sprite.scale.set(this.canvas.width,this.canvas.height,1),this.sprite.position.x=this.canvas.width/2-this.canvas.textWidth/2+this.canvas.textWidth/2*this.align.x,this.sprite.position.y=-this.canvas.height/2+this.canvas.textHeight/2*this.align.y},e}(i(3).Text2D);e.SpriteText2D=o},function(t,e){t.exports=a},function(t,e,i){var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},a=i(2),o=i(4),r=i(5),s=function(t){function e(e,i){void 0===e&&(e=""),void 0===i&&(i={}),t.call(this),this._font=i.font||"30px Arial",this._fillStyle=i.fillStyle||"#FFFFFF",this.canvas=new r.CanvasText,this.align=i.align||o.textAlign.center,this.side=i.side||a.DoubleSide,this.antialias=void 0===i.antialias||i.antialias,this.text=e}return n(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this.canvas.textWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.canvas.textHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){this._text!==t&&(this._text=t,this.updateText())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"font",{get:function(){return this._font},set:function(t){this._font!==t&&(this._font=t,this.updateText())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillStyle",{get:function(){return this._fillStyle},set:function(t){this._fillStyle!==t&&(this._fillStyle=t,this.updateText())},enumerable:!0,configurable:!0}),e.prototype.cleanUp=function(){this.texture&&this.texture.dispose()},e.prototype.applyAntiAlias=function(){!1===this.antialias&&(this.texture.magFilter=a.NearestFilter,this.texture.minFilter=a.LinearMipMapLinearFilter)},e}(a.Object3D);e.Text2D=s},function(t,e,i){var n=i(2);e.textAlign={center:new n.Vector2(0,0),left:new n.Vector2(1,0),topLeft:new n.Vector2(1,-1),topRight:new n.Vector2(-1,-1),right:new n.Vector2(-1,0),bottomLeft:new n.Vector2(1,1),bottomRight:new n.Vector2(-1,1)};var a={};e.getFontHeight=function(t){var e=a[t];if(!e){var i=document.getElementsByTagName("body")[0],n=document.createElement("div"),o=document.createTextNode("MEq");n.appendChild(o),n.setAttribute("style","font:"+t+";position:absolute;top:0;left:0"),i.appendChild(n),e=n.offsetHeight,a[t]=e,i.removeChild(n)}return e}},function(t,e,i){var n=i(2),a=i(4),o=function(){function t(){this.textWidth=null,this.textHeight=null,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}return Object.defineProperty(t.prototype,"width",{get:function(){return this.canvas.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.canvas.height},enumerable:!0,configurable:!0}),t.prototype.drawText=function(t,e){return this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.font=e.font,this.textWidth=Math.ceil(this.ctx.measureText(t).width),this.textHeight=a.getFontHeight(this.ctx.font),this.canvas.width=n.Math.ceilPowerOfTwo(this.textWidth),this.canvas.height=n.Math.ceilPowerOfTwo(this.textHeight),this.ctx.font=e.font,this.ctx.fillStyle=e.fillStyle,this.ctx.textAlign="left",this.ctx.textBaseline="top",this.ctx.fillText(t,0,0),this.canvas},t}();e.CanvasText=o},function(t,e,i){var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},a=i(2),o=function(t){function e(e,i){void 0===e&&(e=""),void 0===i&&(i={}),t.call(this,e,i)}return n(e,t),e.prototype.raycast=function(){this.mesh.raycast.apply(this.mesh,arguments)},e.prototype.updateText=function(){this.cleanUp(),this.canvas.drawText(this._text,{font:this._font,fillStyle:this._fillStyle}),this.texture=new a.Texture(this.canvas.canvas),this.texture.needsUpdate=!0,this.applyAntiAlias(),this.material?this.material.map=this.texture:(this.material=new a.MeshBasicMaterial({map:this.texture,side:this.side}),this.material.transparent=!0),this.mesh||(this.geometry=new a.PlaneGeometry(this.canvas.width,this.canvas.height),this.mesh=new a.Mesh(this.geometry,this.material),this.add(this.mesh)),this.mesh.position.x=this.canvas.width/2-this.canvas.textWidth/2+this.canvas.textWidth/2*this.align.x,this.mesh.position.y=-this.canvas.height/2+this.canvas.textHeight/2*this.align.y,this.geometry.vertices[0].x=this.geometry.vertices[2].x=-this.canvas.width/2,this.geometry.vertices[1].x=this.geometry.vertices[3].x=this.canvas.width/2,this.geometry.vertices[0].y=this.geometry.vertices[1].y=this.canvas.height/2,this.geometry.vertices[2].y=this.geometry.vertices[3].y=-this.canvas.height/2,this.geometry.verticesNeedUpdate=!0},e}(i(3).Text2D);e.MeshText2D=o}]);function c(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var u=function(){function t(e,i){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.nowCell=r,this.width=10,this.body=this.buildBody(i,o),this.maze=e,this.rot=0,this.speed=0,s&&(s.position.set(-40,60,0),s.lookAt(this.body.position.clone().add(new a.Vector3(-5,90,0)).sub(s.position)),this.body.add(s)),this.body.position.copy(this.maze.getNodeToPos(r)),n.add(this.body)}var e,i,o;return e=t,(i=[{key:"buildBody",value:function(t,e){var i=new a.Object3D,n=new a.Mesh(new a.CylinderGeometry(this.width,this.width,10,64),new a.MeshPhongMaterial({color:new a.Color(t)})),o=new a.Mesh(new a.BoxGeometry(2*this.width,10,6),new a.MeshPhongMaterial({color:new a.Color(t)}));if(o.position.set(this.width,0,0),n.add(o),n.position.y=5,i.add(n),null!==e){var r=new l.SpriteText2D("  "+e,{align:l.textAlign.center,font:"40px Arial",fillStyle:"#000000",antialias:!0});r.position.set(0,60,0),r.scale.set(.5,.5,.5),i.add(r)}return i.traverse(function(t){t instanceof a.Mesh&&(t.castShadow=t.receiveShadow=!0)}),i}},{key:"update",value:function(t,e){e.update(),e.pressed("right")&&(this.rot-=.03),e.pressed("left")&&(this.rot+=.03),e.pressed("up")&&(this.speed+=.2),e.pressed("down")&&(this.speed-=.2);var i=new a.Vector3(this.speed,0,0);i.applyAxisAngle(new a.Vector3(0,1,0),this.rot),this.body.rotation.y=this.rot;var n=this.body.position.clone().add(i.clone().multiplyScalar(t));if(this.checkNextPos(n)){this.body.position.add(i.clone().multiplyScalar(t));var o=Math.floor(n.x/this.maze.width),r=Math.floor(n.z/this.maze.width);this.nowCell=r*this.maze.n+o}else this.speed/=2}},{key:"checkNextPos",value:function(t){var e=this.maze.width*this.maze.n,i=this.maze.width*this.maze.m;if(t.x>=0+this.width&&t.z>=0+this.width&&t.x<=e-this.width&&t.z<=i-this.width){for(var n=[[1,1],[-1,1],[1,-1],[-1,-1]],a=0;a<4;a++){var o=Math.floor((t.x+n[a][0]*this.width)/this.maze.width),r=Math.floor((t.z+n[a][1]*this.width)/this.maze.width)*this.maze.n+o;if(r!==this.nowCell&&!this.maze.check(r,this.nowCell))return!1}return!0}return!1}}])&&c(e.prototype,i),o&&c(e,o),t}();function p(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var d=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.initHUD(i)}var e,i,n;return e=t,(i=[{key:"initHUD",value:function(t){t/=2,this.sceneHUD=new a.Scene,this.cameraHUD1=new a.OrthographicCamera(-10.1,10.1,10.1,-10.1,1,50),this.cameraHUD2=new a.OrthographicCamera(-t,t,t,-t,-350,350),this.cameraHUD2.position.set(t,15,t),this.cameraHUD2.up.set(1,0,0),this.cameraHUD2.lookAt(new a.Vector3(t,0,t));var e=new a.Geometry;e.vertices.push(new a.Vector3(-10,-10,0),new a.Vector3(10,-10,0),new a.Vector3(10,10,0),new a.Vector3(-10,10,0),new a.Vector3(-10,-10,0));var i=new a.Line(e,new a.LineBasicMaterial({color:16777215}));this.sceneHUD.add(i)}}])&&p(e.prototype,i),n&&p(e,n),t}();function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function w(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function g(t,e){return!e||"object"!==f(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function y(t,e){return(y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var m,x,b,P,M,N,S,T,C,z,k=function(t){function e(t,i,n){var o,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(o=g(this,v(e).call(this,t,i,n,r,h))).NPCStateTable=Object.freeze({initState:1,findNextPoint:2,GoToPoint:3}),o.NPCState=o.NPCStateTable.initState,o.isTraverse=new Array(t.m*t.n),o.targetNode=new a.Vector3,o.target=0,o.stackPath=[],o.frontNode=-1,o.speed=120,o.traversMode=s,o.traversModeTable=Object.freeze({left:0,right:1,random:2,Astar:3}),o.AstarPath=[],o}var i,o,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e)}(e,u),i=e,(o=[{key:"findNextPoint_Random",value:function(){this.isTraverse[this.nowCell]=!0;for(var t,e=!1,i=0;i<this.maze.graph[this.nowCell].length;i++)if(null!==this.maze.graph[this.nowCell][i]&&!this.isTraverse[this.maze.graph[this.nowCell][i]]){this.stackPath.push(this.nowCell),t=this.maze.graph[this.nowCell][i],e=!0;break}return!(!e&&0==this.stackPath.length)&&(e||(t=this.stackPath[this.stackPath.length-1],this.stackPath.pop()),this.target=t,this.targetNode.copy(this.maze.getNodeToPos(t)),!0)}},{key:"findNextPoint_Left",value:function(){var t;t=(this.maze.graph[this.nowCell].indexOf(this.frontNode)+3)%4;for(var e=0;e<4&&null===this.maze.graph[this.nowCell][t];e++,t=(t+3)%4);return this.frontNode=this.nowCell,this.target=this.maze.graph[this.nowCell][t],this.targetNode.copy(this.maze.getNodeToPos(this.target)),!0}},{key:"findNextPoint_Right",value:function(){var t;t=(this.maze.graph[this.nowCell].indexOf(this.frontNode)+1)%4;for(var e=0;e<4&&null===this.maze.graph[this.nowCell][t];e++,t=(t+1)%4);return this.frontNode=this.nowCell,this.target=this.maze.graph[this.nowCell][t],this.targetNode.copy(this.maze.getNodeToPos(this.target)),!0}},{key:"GoToPoint",value:function(t){var e=this.targetNode.clone().sub(this.body.position).normalize().multiplyScalar(t*this.speed);return this.body.position.add(e),this.body.rotation.y=Math.acos(e.x/e.length()),e.z>0&&(this.body.rotation.y*=-1),this.targetNode.clone().sub(this.body.position).length()<5&&(this.nowCell=this.target,!0)}},{key:"initAstarPath",value:function(){var t=[],e=[];for(t.push({NodeName:0,NodeValue:0,Parent:-1});t.length>0;){for(var i=t[0],n=0,a=1;a<t.length;a++)i.NodeValue>t[a].NodeValue&&(i=t[a],n=a);if(t.splice(n,1),e.push(i),i.NodeName===this.target){for(var o=this.target,r=e.length-1;r>=0;){for(;r>=0&&e[r].NodeName!==o;)r--;if(o===this.nowCell)break;this.AstarPath.push(o),o=e[r].Parent}return void(document.getElementById("hint").innerHTML="最短路徑為"+this.AstarPath.length)}for(var s=0;s<4;s++)if(null!==this.maze.graph[i.NodeName][s]){for(var h=i.NodeValue+1,l=Math.abs(Math.floor(this.target/this.maze.n)-Math.floor(this.maze.graph[i.NodeName][s]/this.maze.n))+Math.abs(this.target%this.maze.n-this.maze.graph[i.NodeName][s]%this.maze.n),c=!1,u=0;u<t.length;u++)t[u].NodeName===this.maze.graph[i.NodeName][s]&&(c=!0,t[u].NodeValue=t[u].NodeValue>h+l?h+l:t[u].NodeValue);for(var p=0;p<e.length;p++)e[p].NodeName===this.maze.graph[i.NodeName][s]&&(c=!0);if(!c){var d={NodeName:this.maze.graph[i.NodeName][s],NodeValue:h+l,Parent:i.NodeName};t.push(d)}}}}},{key:"findNextPoint_Astar",value:function(){if(0===this.AstarPath.length)return!1;this.target=this.AstarPath.pop(),this.targetNode.copy(this.maze.getNodeToPos(this.target));var t=new a.Mesh(new a.SphereGeometry(5,8,6),new a.MeshBasicMaterial({color:new a.Color("yellow")}));return t.position.copy(this.targetNode),n.add(t),!0}},{key:"update",value:function(t){var e;switch(this.NPCState){case this.NPCStateTable.initState:switch(this.traversMode){case this.traversModeTable.Astar:this.initAstarPath();break;default:this.isTraverse.fill(!1),this.isTraverse[this.nowCell]=!0}this.NPCState=this.NPCStateTable.findNextPoint;case this.NPCStateTable.findNextPoint:switch(this.traversMode){case this.traversModeTable.left:e=this.findNextPoint_Left();break;case this.traversModeTable.right:e=this.findNextPoint_Right();break;case this.traversModeTable.Astar:e=this.findNextPoint_Astar()}if(!e){this.NPCState=this.NPCStateTable.initState;break}this.NPCState=this.NPCStateTable.GoToPoint;case this.NPCStateTable.GoToPoint:(e=this.GoToPoint(t))&&(this.NPCState=this.NPCStateTable.findNextPoint)}}}])&&w(i.prototype,o),r&&w(i,r),e}(),O=i(2),_=new(i.n(O).a),j=new a.Raycaster,A=new a.Vector2,D=[],H=new h,V=50,E=10;window.addEventListener("resize",function(){var t=window.innerWidth,e=window.innerHeight;m.aspect=t/e,m.updateProjectionMatrix(),x.setSize(t,e)},!1),document.addEventListener("mousedown",function(t){t.preventDefault(),A.x=t.clientX/window.innerWidth*2-1,A.y=-t.clientY/window.innerHeight*2+1,j.setFromCamera(A,m);var e=j.intersectObjects(D);e.length>0&&(console.log(e[0]),"mazeData"in e[0].object&&(D.splice(D.indexOf(e[0].object),1),n.remove(e[0].object),P.removeWall(e[0].object.mazeData),4===G?((C=new k(P,"orange","NPC3",0,3)).target=E*E-1,function(t){var e=[],i=new Array(P.m*P.n);i.fill(!1),e.push([t,0]),i[t]=!0;for(;e.length>0;){var o=e.shift();i[o[0]]=!0;for(var r=0;r<4;r++)null===P.graph[o[0]][r]||i[P.graph[o[0]][r]]||e.push([P.graph[o[0]][r],o[1]+1]);var s=new l.MeshText2D(o[1],{align:l.textAlign.center,font:"60px Arial",fillStyle:"#ff0000",antialias:!1});s.scale.set(.5,.5,.5),s.rotation.x=-Math.PI/2,s.rotation.z=-Math.PI/2,s.position.copy(P.getNodeToPos(o[0]).add(new a.Vector3(V/3,10,0))),n.add(s)}}(0)):G++))},!1),function(){n=new a.Scene,_.domElement.style.position="absolute",_.domElement.style.top="0px",_.domElement.style.zIndex=100,document.body.appendChild(_.domElement),b=new a.Clock,m=new a.PerspectiveCamera(50,window.innerWidth/window.innerHeight,10,300),n.add(m),new a.GridHelper(500,10,"red","white").position.set(250,0,250),n.add(new a.AxisHelper(50)),(x=new a.WebGLRenderer).setSize(window.innerWidth,window.innerHeight),x.setClearColor(8947848),x.autoClear=!1,document.body.appendChild(x.domElement),(P=new r(E,E,V,5,V)).wall.forEach(function(t){D.push(t)}),N=new u(P,"green",null,0,m),M=new d(N.body,V*E);var t=new a.Mesh(new a.CylinderGeometry(5,5,100,64),new a.MeshBasicMaterial({color:255}));t.position.set(475,50,475),n.add(t);var e=new a.TextureLoader;e.crossOrigin="",e.load("./texture/road/418-418.jpg",function(t){t.wrapS=t.wrapT=a.RepeatWrapping,t.repeat.set(E,E);var e=new a.Mesh(new a.PlaneGeometry(V*E,V*E),new a.MeshPhongMaterial({map:t}));e.rotation.x=-Math.PI/2,e.position.set(V*E/2,0,V*E/2),e.receiveShadow=!0,n.add(e)},void 0,function(t){console.log("error loader texture")}),S=new k(P,"red","",5,0),T=new k(P,"blue","",13,1),n.background=new a.Color(13426943),n.fog=new a.Fog(13426943,250,300),(z=new a.DirectionalLight(11184810)).castShadow=!0,z.shadow.mapSize.width=z.shadow.mapSize.height=1024,z.shadow.camera.left=z.shadow.camera.top=-(V*E/2+150),z.shadow.camera.right=z.shadow.camera.bottom=V*E/2+150,z.shadow.camera.near=1,z.shadow.camera.far=V*E/2+150,z.shadow.bias=-.01,x.shadowMap.enabled=!0,x.shadowMap.type=a.PCFShadowMap,z.position.set(V*E/2+50,200,V*E/2+50),z.target.position.set(V*E/2,0,V*E/2),n.add(z.target),n.add(z,new a.AmbientLight(5592405)),document.getElementById("info").innerHTML="迷宮為"+E+"x"+E}(),function t(){_.update();var e=b.getDelta();N.update(e,H);T.update(e);S.update(e);void 0!==C&&C.update(e);requestAnimationFrame(t);i=window.innerWidth,a=window.innerHeight,x.setScissorTest(!0),x.setViewport(0,0,i,a),x.setScissor(0,0,i,a),x.clear(),x.render(n,m),x.setViewport(.6*i,.6*a,.4*i,.4*a),x.setScissor(.6*i,.6*a,.4*i,.4*a),x.clear(),x.render(n,M.cameraHUD2),x.render(M.sceneHUD,M.cameraHUD1);var i,a}();var G=0}]);
//# sourceMappingURL=main.bundle.js.map