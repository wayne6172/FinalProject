!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=13)}([function(e,t,n){e.exports=n(1)(0)},function(e,t){e.exports=vendor_b74a3bec153adcb8f4e7},function(e,t,n){e.exports=n(1)(3)},function(e,t,n){var r=n(0),i=function(){function e(e){r.Loader.call(this,e),this.dracoLoader=null,this.ddsLoader=null}function t(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(r.Loader.prototype),{constructor:e,load:function(e,t,n,i){var a,o=this;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:r.LoaderUtils.extractUrlBase(e),o.manager.itemStart(e);var s=function(t){i?i(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},l=new r.FileLoader(o.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),"use-credentials"===o.crossOrigin&&l.setWithCredentials(!0),l.load(e,function(n){try{o.parse(n,a,function(n){t(n),o.manager.itemEnd(e)},s)}catch(e){s(e)}},n,s)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},parse:function(e,t,l,c){var d,m={};if("string"==typeof e)d=e;else if(r.LoaderUtils.decodeText(new Uint8Array(e,0,4))===s){try{m[n.KHR_BINARY_GLTF]=new u(e)}catch(e){return void(c&&c(e))}d=m[n.KHR_BINARY_GLTF].content}else d=r.LoaderUtils.decodeText(new Uint8Array(e));var g=JSON.parse(d);if(void 0===g.asset||g.asset.version[0]<2)c&&c(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(g.extensionsUsed)for(var v=0;v<g.extensionsUsed.length;++v){var y=g.extensionsUsed[v],w=g.extensionsRequired||[];switch(y){case n.KHR_LIGHTS_PUNCTUAL:m[y]=new a(g);break;case n.KHR_MATERIALS_UNLIT:m[y]=new o;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:m[y]=new f;break;case n.KHR_DRACO_MESH_COMPRESSION:m[y]=new h(g,this.dracoLoader);break;case n.MSFT_TEXTURE_DDS:m[y]=new i(this.ddsLoader);break;case n.KHR_TEXTURE_TRANSFORM:m[y]=new p;break;default:w.indexOf(y)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+y+'".')}}new F(g,m,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(l,c)}}});var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function i(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=n.MSFT_TEXTURE_DDS,this.ddsLoader=e}function a(e){this.name=n.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[n.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function o(){this.name=n.KHR_MATERIALS_UNLIT}a.prototype.loadLight=function(e){var t,n=this.lightDefs[e],i=new r.Color(16777215);void 0!==n.color&&i.fromArray(n.color);var a=void 0!==n.range?n.range:0;switch(n.type){case"directional":(t=new r.DirectionalLight(i)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new r.PointLight(i)).distance=a;break;case"spot":(t=new r.SpotLight(i)).distance=a,n.spot=n.spot||{},n.spot.innerConeAngle=void 0!==n.spot.innerConeAngle?n.spot.innerConeAngle:0,n.spot.outerConeAngle=void 0!==n.spot.outerConeAngle?n.spot.outerConeAngle:Math.PI/4,t.angle=n.spot.outerConeAngle,t.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+n.type+'".')}return t.position.set(0,0,0),t.decay=2,void 0!==n.intensity&&(t.intensity=n.intensity),t.name=n.name||"light_"+e,Promise.resolve(t)},o.prototype.getMaterialType=function(){return r.MeshBasicMaterial},o.prototype.extendParams=function(e,t,n){var i=[];e.color=new r.Color(1,1,1),e.opacity=1;var a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){var o=a.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==a.baseColorTexture&&i.push(n.assignTexture(e,"map",a.baseColorTexture))}return Promise.all(i)};var s="glTF",l=12,c={JSON:1313821514,BIN:5130562};function u(e){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,l);if(this.header={magic:r.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==s)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var i=new DataView(e,l),a=0;a<i.byteLength;){var o=i.getUint32(a,!0);a+=4;var u=i.getUint32(a,!0);if(a+=4,u===c.JSON){var h=new Uint8Array(e,l+a,o);this.content=r.LoaderUtils.decodeText(h)}else if(u===c.BIN){var p=l+a;this.body=e.slice(p,p+o)}a+=o}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function h(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t}function p(){this.name=n.KHR_TEXTURE_TRANSFORM}function f(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return r.ShaderMaterial},extendParams:function(e,t,n){var i=t.extensions[this.name],a=r.ShaderLib.standard,o=r.UniformsUtils.clone(a.uniforms),s=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),l=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),c=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),u=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),h=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),p=a.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",s).replace("#include <metalnessmap_pars_fragment>",l).replace("#include <roughnessmap_fragment>",c).replace("#include <metalnessmap_fragment>",u).replace("#include <lights_physical_fragment>",h);delete o.roughness,delete o.metalness,delete o.roughnessMap,delete o.metalnessMap,o.specular={value:(new r.Color).setHex(1118481)},o.glossiness={value:.5},o.specularMap={value:null},o.glossinessMap={value:null},e.vertexShader=a.vertexShader,e.fragmentShader=p,e.uniforms=o,e.defines={STANDARD:""},e.color=new r.Color(1,1,1),e.opacity=1;var f=[];if(Array.isArray(i.diffuseFactor)){var d=i.diffuseFactor;e.color.fromArray(d),e.opacity=d[3]}if(void 0!==i.diffuseTexture&&f.push(n.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new r.Color(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new r.Color(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var m=i.specularGlossinessTexture;f.push(n.assignTexture(e,"glossinessMap",m)),f.push(n.assignTexture(e,"specularMap",m))}return Promise.all(f)},createMaterial:function(e){var t=new r.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var n=this.specularGlossinessParams,r=0,i=n.length;r<i;r++){var a=e[n[r]];t[n[r]]=a&&a.isColor?a.clone():a}return t},refreshUniforms:function(e,t,n,r,i){if(!0===i.isGLTFSpecularGlossinessMaterial){var a,o=i.uniforms,s=i.defines;o.opacity.value=i.opacity,o.diffuse.value.copy(i.color),o.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),o.map.value=i.map,o.specularMap.value=i.specularMap,o.alphaMap.value=i.alphaMap,o.lightMap.value=i.lightMap,o.lightMapIntensity.value=i.lightMapIntensity,o.aoMap.value=i.aoMap,o.aoMapIntensity.value=i.aoMapIntensity,i.map?a=i.map:i.specularMap?a=i.specularMap:i.displacementMap?a=i.displacementMap:i.normalMap?a=i.normalMap:i.bumpMap?a=i.bumpMap:i.glossinessMap?a=i.glossinessMap:i.alphaMap?a=i.alphaMap:i.emissiveMap&&(a=i.emissiveMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),o.uvTransform.value.copy(a.matrix)),i.envMap&&(o.envMap.value=i.envMap,o.envMapIntensity.value=i.envMapIntensity,o.flipEnvMap.value=i.envMap.isCubeTexture?-1:1,o.reflectivity.value=i.reflectivity,o.refractionRatio.value=i.refractionRatio,o.maxMipLevel.value=e.properties.get(i.envMap).__maxMipLevel),o.specular.value.copy(i.specular),o.glossiness.value=i.glossiness,o.glossinessMap.value=i.glossinessMap,o.emissiveMap.value=i.emissiveMap,o.bumpMap.value=i.bumpMap,o.normalMap.value=i.normalMap,o.displacementMap.value=i.displacementMap,o.displacementScale.value=i.displacementScale,o.displacementBias.value=i.displacementBias,null!==o.glossinessMap.value&&void 0===s.USE_GLOSSINESSMAP&&(s.USE_GLOSSINESSMAP="",s.USE_ROUGHNESSMAP=""),null===o.glossinessMap.value&&void 0!==s.USE_GLOSSINESSMAP&&(delete s.USE_GLOSSINESSMAP,delete s.USE_ROUGHNESSMAP)}}}}function d(e,t,n,i){r.Interpolant.call(this,e,t,n,i)}h.prototype.decodePrimitive=function(e,t){var n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},l={};for(var c in a){var u=A[c]||c.toLowerCase();o[u]=a[c]}for(c in e.attributes){u=A[c]||c.toLowerCase();if(void 0!==a[c]){var h=n.accessors[e.attributes[c]],p=S[h.componentType];l[u]=p,s[u]=!0===h.normalized}}return t.getDependency("bufferView",i).then(function(e){return new Promise(function(t){r.decodeDracoFile(e,function(e){for(var n in e.attributes){var r=e.attributes[n],i=s[n];void 0!==i&&(r.normalized=i)}t(e)},o,l)})})},p.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},d.prototype=Object.create(r.Interpolant.prototype),d.prototype.constructor=d,d.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r,a=0;a!==r;a++)t[a]=n[i+a];return t},d.prototype.beforeStart_=d.prototype.copySampleValue_,d.prototype.afterEnd_=d.prototype.copySampleValue_,d.prototype.interpolate_=function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,c=r-t,u=(n-t)/c,h=u*u,p=h*u,f=e*l,d=f-l,m=-2*p+3*h,g=p-h,v=1-m,y=g-h+u,w=0;w!==o;w++){var b=a[d+w+o],M=a[d+w+s]*c,x=a[f+w+o],S=a[f+w]*c;i[w]=v*b+y*M+m*x+g*S}return i};var m,g=0,v=1,y=2,w=3,b=4,M=5,x=6,S={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},T={9728:r.NearestFilter,9729:r.LinearFilter,9984:r.NearestMipmapNearestFilter,9985:r.LinearMipmapNearestFilter,9986:r.NearestMipmapLinearFilter,9987:r.LinearMipmapLinearFilter},P={33071:r.ClampToEdgeWrapping,33648:r.MirroredRepeatWrapping,10497:r.RepeatWrapping},E={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},A={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},R={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},_={CUBICSPLINE:void 0,LINEAR:r.InterpolateLinear,STEP:r.InterpolateDiscrete},L="OPAQUE",N="MASK",O="BLEND",C={"image/png":r.RGBAFormat,"image/jpeg":r.RGBFormat};function D(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e)}function k(e,t,n){for(var r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function U(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function I(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(n=0,r=i.length;n<r;n++)e.morphTargetDictionary[i[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function j(e){for(var t="",n=Object.keys(e).sort(),r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function H(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,n=e.itemSize,i=e.array.slice(0,t*n),a=0,o=0;a<t;++a)i[o++]=e.getX(a),n>=2&&(i[o++]=e.getY(a)),n>=3&&(i[o++]=e.getZ(a)),n>=4&&(i[o++]=e.getW(a));return new r.BufferAttribute(i,n,e.normalized)}return e.clone()}function F(e,n,i){this.json=e||{},this.extensions=n||{},this.options=i||{},this.cache=new t,this.primitiveCache={},this.textureLoader=new r.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new r.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function z(e,t,n){var r=t.attributes,i=[];function a(t,r){return n.getDependency("accessor",t).then(function(t){e.setAttribute(r,t)})}for(var o in r){var s=A[o]||o.toLowerCase();s in e.attributes||i.push(a(r[o],s))}if(void 0!==t.indices&&!e.index){var l=n.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});i.push(l)}return U(e,t),Promise.all(i).then(function(){return void 0!==t.targets?function(e,t,n){for(var r=!1,i=!1,a=0,o=t.length;a<o&&(void 0!==(c=t[a]).POSITION&&(r=!0),void 0!==c.NORMAL&&(i=!0),!r||!i);a++);if(!r&&!i)return Promise.resolve(e);var s=[],l=[];for(a=0,o=t.length;a<o;a++){var c=t[a];if(r){var u=void 0!==c.POSITION?n.getDependency("accessor",c.POSITION):e.attributes.position;s.push(u)}i&&(u=void 0!==c.NORMAL?n.getDependency("accessor",c.NORMAL):e.attributes.normal,l.push(u))}return Promise.all([Promise.all(s),Promise.all(l)]).then(function(n){for(var a=n[0],o=n[1],s=0,l=a.length;s<l;s++)e.attributes.position!==a[s]&&(a[s]=H(a[s]));for(s=0,l=o.length;s<l;s++)e.attributes.normal!==o[s]&&(o[s]=H(o[s]));for(s=0,l=t.length;s<l;s++){var c=t[s],u="morphTarget"+s;if(r&&void 0!==c.POSITION){var h=a[s];h.name=u;for(var p=e.attributes.position,f=0,d=h.count;f<d;f++)h.setXYZ(f,h.getX(f)+p.getX(f),h.getY(f)+p.getY(f),h.getZ(f)+p.getZ(f))}if(i&&void 0!==c.NORMAL){var m=o[s];m.name=u;var g=e.attributes.normal;for(f=0,d=m.count;f<d;f++)m.setXYZ(f,m.getX(f)+g.getX(f),m.getY(f)+g.getY(f),m.getZ(f)+g.getZ(f))}}return r&&(e.morphAttributes.position=a),i&&(e.morphAttributes.normal=o),e})}(e,t.targets,n):e})}return F.prototype.parse=function(e,t){var n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(t){var a={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};k(i,a,r),U(a,r),e(a)}).catch(t)},F.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],r={},i={},a=0,o=t.length;a<o;a++)for(var s=t[a].joints,l=0,c=s.length;l<c;l++)e[s[l]].isBone=!0;for(var u=0,h=e.length;u<h;u++){var p=e[u];void 0!==p.mesh&&(void 0===r[p.mesh]&&(r[p.mesh]=i[p.mesh]=0),r[p.mesh]++,void 0!==p.skin&&(n[p.mesh].isSkinnedMesh=!0))}this.json.meshReferences=r,this.json.meshUses=i},F.prototype.getDependency=function(e,t){var r=e+":"+t,i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this.loadMesh(t);break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this.loadBufferView(t);break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this.loadMaterial(t);break;case"texture":i=this.loadTexture(t);break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;case"light":i=this.extensions[n.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,i)}return i},F.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map(function(t,r){return n.getDependency(e,r)})),this.cache.add(e,t)}return t},F.prototype.loadBuffer=function(e){var t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);var i=this.options;return new Promise(function(e,n){r.load(D(t.uri,i.path),e,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},F.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)})},F.prototype.loadAccessor=function(e){var t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);var a=[];return void 0!==i.bufferView?a.push(this.getDependency("bufferView",i.bufferView)):a.push(null),void 0!==i.sparse&&(a.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(a).then(function(e){var a,o,s=e[0],l=E[i.type],c=S[i.componentType],u=c.BYTES_PER_ELEMENT,h=u*l,p=i.byteOffset||0,f=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,d=!0===i.normalized;if(f&&f!==h){var m=Math.floor(p/f),g="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+m+":"+i.count,v=t.cache.get(g);v||(a=new c(s,m*f,i.count*f/u),v=new r.InterleavedBuffer(a,f/u),t.cache.add(g,v)),o=new r.InterleavedBufferAttribute(v,l,p%f/u,d)}else a=null===s?new c(i.count*l):new c(s,p,i.count*l),o=new r.BufferAttribute(a,l,d);if(void 0!==i.sparse){var y=E.SCALAR,w=S[i.sparse.indices.componentType],b=i.sparse.indices.byteOffset||0,M=i.sparse.values.byteOffset||0,x=new w(e[1],b,i.sparse.count*y),T=new c(e[2],M,i.sparse.count*l);null!==s&&(o=new r.BufferAttribute(o.array.slice(),o.itemSize,o.normalized));for(var P=0,A=x.length;P<A;P++){var R=x[P];if(o.setX(R,T[P*l]),l>=2&&o.setY(R,T[P*l+1]),l>=3&&o.setZ(R,T[P*l+2]),l>=4&&o.setW(R,T[P*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o})},F.prototype.loadTexture=function(e){var t,i=this,a=this.json,o=this.options,s=this.textureLoader,l=window.URL||window.webkitURL,c=a.textures[e],u=c.extensions||{},h=(t=u[n.MSFT_TEXTURE_DDS]?a.images[u[n.MSFT_TEXTURE_DDS].source]:a.images[c.source]).uri,p=!1;return void 0!==t.bufferView&&(h=i.getDependency("bufferView",t.bufferView).then(function(e){p=!0;var n=new Blob([e],{type:t.mimeType});return h=l.createObjectURL(n)})),Promise.resolve(h).then(function(e){var t=o.manager.getHandler(e);return t||(t=u[n.MSFT_TEXTURE_DDS]?i.extensions[n.MSFT_TEXTURE_DDS].ddsLoader:s),new Promise(function(n,r){t.load(D(e,o.path),n,void 0,r)})}).then(function(e){!0===p&&l.revokeObjectURL(h),e.flipY=!1,void 0!==c.name&&(e.name=c.name),t.mimeType in C&&(e.format=C[t.mimeType]);var n=(a.samplers||{})[c.sampler]||{};return e.magFilter=T[n.magFilter]||r.LinearFilter,e.minFilter=T[n.minFilter]||r.LinearMipmapLinearFilter,e.wrapS=P[n.wrapS]||r.RepeatWrapping,e.wrapT=P[n.wrapT]||r.RepeatWrapping,e})},F.prototype.assignTexture=function(e,t,i){var a=this;return this.getDependency("texture",i.index).then(function(o){if(!o.isCompressedTexture)switch(t){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":o.format=r.RGBFormat}if(a.extensions[n.KHR_TEXTURE_TRANSFORM]){var s=void 0!==i.extensions?i.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;s&&(o=a.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(o,s))}e[t]=o})},F.prototype.assignFinalMaterial=function(e){var t=e.geometry,i=e.material,a=this.extensions,o=void 0!==t.attributes.tangent,s=void 0!==t.attributes.color,l=void 0===t.attributes.normal,c=!0===e.isSkinnedMesh,u=Object.keys(t.morphAttributes).length>0,h=u&&void 0!==t.morphAttributes.normal;if(e.isPoints){var p="PointsMaterial:"+i.uuid,f=this.cache.get(p);f||(f=new r.PointsMaterial,r.Material.prototype.copy.call(f,i),f.color.copy(i.color),f.map=i.map,f.sizeAttenuation=!1,this.cache.add(p,f)),i=f}else if(e.isLine){p="LineBasicMaterial:"+i.uuid;var d=this.cache.get(p);d||(d=new r.LineBasicMaterial,r.Material.prototype.copy.call(d,i),d.color.copy(i.color),this.cache.add(p,d)),i=d}if(o||s||l||c||u){p="ClonedMaterial:"+i.uuid+":";i.isGLTFSpecularGlossinessMaterial&&(p+="specular-glossiness:"),c&&(p+="skinning:"),o&&(p+="vertex-tangents:"),s&&(p+="vertex-colors:"),l&&(p+="flat-shading:"),u&&(p+="morph-targets:"),h&&(p+="morph-normals:");var m=this.cache.get(p);m||(m=i.isGLTFSpecularGlossinessMaterial?a[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(i):i.clone(),c&&(m.skinning=!0),o&&(m.vertexTangents=!0),s&&(m.vertexColors=r.VertexColors),l&&(m.flatShading=!0),u&&(m.morphTargets=!0),h&&(m.morphNormals=!0),this.cache.add(p,m)),i=m}i.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),t.setAttribute("uv2",new r.BufferAttribute(t.attributes.uv.array,2))),i.isGLTFSpecularGlossinessMaterial&&(e.onBeforeRender=a[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),e.material=i},F.prototype.loadMaterial=function(e){var t,i=this.json,a=this.extensions,o=i.materials[e],s={},l=o.extensions||{},c=[];if(l[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=a[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=u.getMaterialType(),c.push(u.extendParams(s,o,this))}else if(l[n.KHR_MATERIALS_UNLIT]){var h=a[n.KHR_MATERIALS_UNLIT];t=h.getMaterialType(),c.push(h.extendParams(s,o,this))}else{t=r.MeshStandardMaterial;var p=o.pbrMetallicRoughness||{};if(s.color=new r.Color(1,1,1),s.opacity=1,Array.isArray(p.baseColorFactor)){var f=p.baseColorFactor;s.color.fromArray(f),s.opacity=f[3]}void 0!==p.baseColorTexture&&c.push(this.assignTexture(s,"map",p.baseColorTexture)),s.metalness=void 0!==p.metallicFactor?p.metallicFactor:1,s.roughness=void 0!==p.roughnessFactor?p.roughnessFactor:1,void 0!==p.metallicRoughnessTexture&&(c.push(this.assignTexture(s,"metalnessMap",p.metallicRoughnessTexture)),c.push(this.assignTexture(s,"roughnessMap",p.metallicRoughnessTexture)))}!0===o.doubleSided&&(s.side=r.DoubleSide);var d=o.alphaMode||L;return d===O?s.transparent=!0:(s.transparent=!1,d===N&&(s.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&t!==r.MeshBasicMaterial&&(c.push(this.assignTexture(s,"normalMap",o.normalTexture)),s.normalScale=new r.Vector2(1,1),void 0!==o.normalTexture.scale&&s.normalScale.set(o.normalTexture.scale,o.normalTexture.scale)),void 0!==o.occlusionTexture&&t!==r.MeshBasicMaterial&&(c.push(this.assignTexture(s,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(s.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&t!==r.MeshBasicMaterial&&(s.emissive=(new r.Color).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&t!==r.MeshBasicMaterial&&c.push(this.assignTexture(s,"emissiveMap",o.emissiveTexture)),Promise.all(c).then(function(){var e;return e=t===r.ShaderMaterial?a[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new t(s),void 0!==o.name&&(e.name=o.name),e.map&&(e.map.encoding=r.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=r.sRGBEncoding),e.specularMap&&(e.specularMap.encoding=r.sRGBEncoding),U(e,o),o.extensions&&k(a,e,o),e})},F.prototype.loadGeometries=function(e){var t=this,i=this.extensions,a=this.primitiveCache;function o(e){return i[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(n){return z(n,e,t)})}for(var s,l,c=[],u=0,h=e.length;u<h;u++){var p,f=e[u],d=(l=void 0,(l=(s=f).extensions&&s.extensions[n.KHR_DRACO_MESH_COMPRESSION])?"draco:"+l.bufferView+":"+l.indices+":"+j(l.attributes):s.indices+":"+j(s.attributes)+":"+s.mode),m=a[d];if(m)c.push(m.promise);else p=f.extensions&&f.extensions[n.KHR_DRACO_MESH_COMPRESSION]?o(f):z(new r.BufferGeometry,f,t),a[d]={primitive:f,promise:p},c.push(p)}return Promise.all(c)},F.prototype.loadMesh=function(e){for(var t=this,n=this.json.meshes[e],i=n.primitives,a=[],o=0,s=i.length;o<s;o++){var l=void 0===i[o].material?m=m||new r.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:r.FrontSide}):this.getDependency("material",i[o].material);a.push(l)}return Promise.all(a).then(function(a){return t.loadGeometries(i).then(function(o){for(var s=[],l=0,c=o.length;l<c;l++){var u,h=o[l],p=i[l],f=a[l];if(p.mode===b||p.mode===M||p.mode===x||void 0===p.mode)!0!==(u=!0===n.isSkinnedMesh?new r.SkinnedMesh(h,f):new r.Mesh(h,f)).isSkinnedMesh||u.geometry.attributes.skinWeight.normalized||u.normalizeSkinWeights(),p.mode===M?u.drawMode=r.TriangleStripDrawMode:p.mode===x&&(u.drawMode=r.TriangleFanDrawMode);else if(p.mode===v)u=new r.LineSegments(h,f);else if(p.mode===w)u=new r.Line(h,f);else if(p.mode===y)u=new r.LineLoop(h,f);else{if(p.mode!==g)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);u=new r.Points(h,f)}Object.keys(u.geometry.morphAttributes).length>0&&I(u,n),u.name=n.name||"mesh_"+e,o.length>1&&(u.name+="_"+l),U(u,n),t.assignFinalMaterial(u),s.push(u)}if(1===s.length)return s[0];var d=new r.Group;for(l=0,c=s.length;l<c;l++)d.add(s[l]);return d})})},F.prototype.loadCamera=function(e){var t,n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new r.PerspectiveCamera(r.Math.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new r.OrthographicCamera(i.xmag/-2,i.xmag/2,i.ymag/2,i.ymag/-2,i.znear,i.zfar)),void 0!==n.name&&(t.name=n.name),U(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},F.prototype.loadSkin=function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return n.inverseBindMatrices=e,n})},F.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],n=[],i=[],a=[],o=[],s=[],l=0,c=t.channels.length;l<c;l++){var u=t.channels[l],h=t.samplers[u.sampler],p=u.target,f=void 0!==p.node?p.node:p.id,m=void 0!==t.parameters?t.parameters[h.input]:h.input,g=void 0!==t.parameters?t.parameters[h.output]:h.output;n.push(this.getDependency("node",f)),i.push(this.getDependency("accessor",m)),a.push(this.getDependency("accessor",g)),o.push(h),s.push(p)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(a),Promise.all(o),Promise.all(s)]).then(function(n){for(var i=n[0],a=n[1],o=n[2],s=n[3],l=n[4],c=[],u=0,h=i.length;u<h;u++){var p=i[u],f=a[u],m=o[u],g=s[u],v=l[u];if(void 0!==p){var y;switch(p.updateMatrix(),p.matrixAutoUpdate=!0,R[v.path]){case R.weights:y=r.NumberKeyframeTrack;break;case R.rotation:y=r.QuaternionKeyframeTrack;break;case R.position:case R.scale:default:y=r.VectorKeyframeTrack}var w=p.name?p.name:p.uuid,b=void 0!==g.interpolation?_[g.interpolation]:r.InterpolateLinear,M=[];R[v.path]===R.weights?p.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&M.push(e.name?e.name:e.uuid)}):M.push(w);var x=m.array;if(m.normalized){var S;if(x.constructor===Int8Array)S=1/127;else if(x.constructor===Uint8Array)S=1/255;else if(x.constructor==Int16Array)S=1/32767;else{if(x.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");S=1/65535}for(var T=new Float32Array(x.length),P=0,E=x.length;P<E;P++)T[P]=x[P]*S;x=T}for(P=0,E=M.length;P<E;P++){var A=new y(M[P]+"."+R[v.path],f.array,x,b);"CUBICSPLINE"===g.interpolation&&(A.createInterpolant=function(e){return new d(this.times,this.values,this.getValueSize()/3,e)},A.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(A)}}}var L=void 0!==t.name?t.name:"animation_"+e;return new r.AnimationClip(L,void 0,c)})},F.prototype.loadNode=function(e){var t,i=this.json,a=this.extensions,o=this,s=i.meshReferences,l=i.meshUses,c=i.nodes[e];return(t=[],void 0!==c.mesh&&t.push(o.getDependency("mesh",c.mesh).then(function(e){var t;if(s[c.mesh]>1){var n=l[c.mesh]++;(t=e.clone()).name+="_instance_"+n,t.onBeforeRender=e.onBeforeRender;for(var r=0,i=t.children.length;r<i;r++)t.children[r].name+="_instance_"+n,t.children[r].onBeforeRender=e.children[r].onBeforeRender}else t=e;return void 0!==c.weights&&t.traverse(function(e){if(e.isMesh)for(var t=0,n=c.weights.length;t<n;t++)e.morphTargetInfluences[t]=c.weights[t]}),t})),void 0!==c.camera&&t.push(o.getDependency("camera",c.camera)),c.extensions&&c.extensions[n.KHR_LIGHTS_PUNCTUAL]&&void 0!==c.extensions[n.KHR_LIGHTS_PUNCTUAL].light&&t.push(o.getDependency("light",c.extensions[n.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(t)).then(function(e){var t;if((t=!0===c.isBone?new r.Bone:e.length>1?new r.Group:1===e.length?e[0]:new r.Object3D)!==e[0])for(var n=0,i=e.length;n<i;n++)t.add(e[n]);if(void 0!==c.name&&(t.userData.name=c.name,t.name=r.PropertyBinding.sanitizeNodeName(c.name)),U(t,c),c.extensions&&k(a,t,c),void 0!==c.matrix){var o=new r.Matrix4;o.fromArray(c.matrix),t.applyMatrix(o)}else void 0!==c.translation&&t.position.fromArray(c.translation),void 0!==c.rotation&&t.quaternion.fromArray(c.rotation),void 0!==c.scale&&t.scale.fromArray(c.scale);return t})},F.prototype.loadScene=function(){function e(t,n,i,a){var o=i.nodes[t];return a.getDependency("node",t).then(function(e){return void 0===o.skin?e:a.getDependency("skin",o.skin).then(function(e){for(var n=[],r=0,i=(t=e).joints.length;r<i;r++)n.push(a.getDependency("node",t.joints[r]));return Promise.all(n)}).then(function(n){return e.traverse(function(e){if(e.isMesh){for(var i=[],a=[],o=0,s=n.length;o<s;o++){var l=n[o];if(l){i.push(l);var c=new r.Matrix4;void 0!==t.inverseBindMatrices&&c.fromArray(t.inverseBindMatrices.array,16*o),a.push(c)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}e.bind(new r.Skeleton(i,a),e.matrixWorld)}}),e});var t}).then(function(t){n.add(t);var r=[];if(o.children)for(var s=o.children,l=0,c=s.length;l<c;l++){var u=s[l];r.push(e(u,t,i,a))}return Promise.all(r)})}return function(t){var n=this.json,i=this.extensions,a=this.json.scenes[t],o=new r.Scene;void 0!==a.name&&(o.name=a.name),U(o,a),a.extensions&&k(i,o,a);for(var s=a.nodes||[],l=[],c=0,u=s.length;c<u;c++)l.push(e(s[c],o,n,this));return Promise.all(l).then(function(){return o})}}(),e}();e.exports=i},function(e,t,n){e.exports=function(){"use strict";var e=function(){var t=0,n=document.createElement("div");function r(e){return n.appendChild(e.dom),e}function i(e){for(var r=0;r<n.children.length;r++)n.children[r].style.display=r===e?"block":"none";t=e}n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(e){e.preventDefault(),i(++t%n.children.length)},!1);var a=(performance||Date).now(),o=a,s=0,l=r(new e.Panel("FPS","#0ff","#002")),c=r(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=r(new e.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:n,addPanel:r,showPanel:i,begin:function(){a=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(c.update(e-a,200),o+1e3<=e&&(l.update(1e3*s/(e-o),100),o=e,s=0,u)){var t=performance.memory;u.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){a=this.end()},domElement:n,setMode:i}};return e.Panel=function(e,t,n){var r=1/0,i=0,a=Math.round,o=a(window.devicePixelRatio||1),s=80*o,l=48*o,c=3*o,u=2*o,h=3*o,p=15*o,f=74*o,d=30*o,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,s,l),g.fillStyle=t,g.fillText(e,c,u),g.fillRect(h,p,f,d),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h,p,f,d),{dom:m,update:function(l,v){r=Math.min(r,l),i=Math.max(i,l),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,s,p),g.fillStyle=t,g.fillText(a(l)+" "+e+" ("+a(r)+"-"+a(i)+")",c,u),g.drawImage(m,h+o,p,f-o,d,h,p,f-o,d),g.fillRect(h+f-o,p,o,d),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h+f-o,p,o,a((1-l/v)*d))}}},e}()},function(e,t,n){e.exports=n(1)(2)},function(e,t,n){"use strict";(function(t){var r=n(8);
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function i(e,t){if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0}function a(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var o=n(9),s=Object.prototype.hasOwnProperty,l=Array.prototype.slice,c="foo"===function(){}.name;function u(e){return Object.prototype.toString.call(e)}function h(e){return!a(e)&&("function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}var p=e.exports=y,f=/\s*function\s+([^\(\s]*)\s*/;function d(e){if(o.isFunction(e)){if(c)return e.name;var t=e.toString().match(f);return t&&t[1]}}function m(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function g(e){if(c||!o.isFunction(e))return o.inspect(e);var t=d(e);return"[Function"+(t?": "+t:"")+"]"}function v(e,t,n,r,i){throw new p.AssertionError({message:n,actual:e,expected:t,operator:r,stackStartFunction:i})}function y(e,t){e||v(e,!0,t,"==",p.ok)}function w(e,t,n,r){if(e===t)return!0;if(a(e)&&a(t))return 0===i(e,t);if(o.isDate(e)&&o.isDate(t))return e.getTime()===t.getTime();if(o.isRegExp(e)&&o.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(h(e)&&h(t)&&u(e)===u(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===i(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(a(e)!==a(t))return!1;var s=(r=r||{actual:[],expected:[]}).actual.indexOf(e);return-1!==s&&s===r.expected.indexOf(t)||(r.actual.push(e),r.expected.push(t),function(e,t,n,r){if(null==e||null==t)return!1;if(o.isPrimitive(e)||o.isPrimitive(t))return e===t;if(n&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var i=b(e),a=b(t);if(i&&!a||!i&&a)return!1;if(i)return e=l.call(e),t=l.call(t),w(e,t,n);var s,c,u=S(e),h=S(t);if(u.length!==h.length)return!1;for(u.sort(),h.sort(),c=u.length-1;c>=0;c--)if(u[c]!==h[c])return!1;for(c=u.length-1;c>=0;c--)if(s=u[c],!w(e[s],t[s],n,r))return!1;return!0}(e,t,n,r))}return n?e===t:e==t}function b(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function M(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function x(e,t,n,r){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(r=n,n=null),i=function(e){var t;try{e()}catch(e){t=e}return t}(t),r=(n&&n.name?" ("+n.name+").":".")+(r?" "+r:"."),e&&!i&&v(i,n,"Missing expected exception"+r);var a="string"==typeof r,s=!e&&i&&!n;if((!e&&o.isError(i)&&a&&M(i,n)||s)&&v(i,n,"Got unwanted exception"+r),e&&i&&n&&!M(i,n)||!e&&i)throw i}p.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return m(g(e.actual),128)+" "+e.operator+" "+m(g(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||v;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var r=n.stack,i=d(t),a=r.indexOf("\n"+i);if(a>=0){var o=r.indexOf("\n",a+1);r=r.substring(o+1)}this.stack=r}}},o.inherits(p.AssertionError,Error),p.fail=v,p.ok=y,p.equal=function(e,t,n){e!=t&&v(e,t,n,"==",p.equal)},p.notEqual=function(e,t,n){e==t&&v(e,t,n,"!=",p.notEqual)},p.deepEqual=function(e,t,n){w(e,t,!1)||v(e,t,n,"deepEqual",p.deepEqual)},p.deepStrictEqual=function(e,t,n){w(e,t,!0)||v(e,t,n,"deepStrictEqual",p.deepStrictEqual)},p.notDeepEqual=function(e,t,n){w(e,t,!1)&&v(e,t,n,"notDeepEqual",p.notDeepEqual)},p.notDeepStrictEqual=function e(t,n,r){w(t,n,!0)&&v(t,n,r,"notDeepStrictEqual",e)},p.strictEqual=function(e,t,n){e!==t&&v(e,t,n,"===",p.strictEqual)},p.notStrictEqual=function(e,t,n){e===t&&v(e,t,n,"!==",p.notStrictEqual)},p.throws=function(e,t,n){x(!0,e,t,n)},p.doesNotThrow=function(e,t,n){x(!1,e,t,n)},p.ifError=function(e){if(e)throw e},p.strict=r(function e(t,n){t||v(t,!0,n,"==",e)},p,{equal:p.strictEqual,deepEqual:p.deepStrictEqual,notEqual:p.notStrictEqual,notDeepEqual:p.notDeepStrictEqual}),p.strict.strict=p.strict;var S=Object.keys||function(e){var t=[];for(var n in e)s.call(e,n)&&t.push(n);return t}}).call(this,n(7))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;function o(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,s,l=o(e),c=1;c<arguments.length;c++){for(var u in n=Object(arguments[c]))i.call(n,u)&&(l[u]=n[u]);if(r){s=r(n);for(var h=0;h<s.length;h++)a.call(n,s[h])&&(l[s[h]]=n[s[h]])}}return l}},function(e,t,n){(function(e){var r=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},i=/%[sdj%]/g;t.format=function(e){if(!v(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,a=r.length,o=String(e).replace(i,function(e){if("%%"===e)return"%";if(n>=a)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),l=r[n];n<a;l=r[++n])m(l)||!b(l)?o+=" "+l:o+=" "+s(l);return o},t.deprecate=function(n,r){if(void 0!==e&&!0===e.noDeprecation)return n;if(void 0===e)return function(){return t.deprecate(n,r).apply(this,arguments)};var i=!1;return function(){if(!i){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),i=!0}return n.apply(this,arguments)}};var a,o={};function s(e,n){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),d(n)?r.showHidden=n:n&&t._extend(r,n),y(r.showHidden)&&(r.showHidden=!1),y(r.depth)&&(r.depth=2),y(r.colors)&&(r.colors=!1),y(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=l),u(r,e,r.depth)}function l(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function c(e,t){return e}function u(e,n,r){if(e.customInspect&&n&&S(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return v(i)||(i=u(e,i,r)),i}var a=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(v(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(g(t))return e.stylize(""+t,"number");if(d(t))return e.stylize(""+t,"boolean");if(m(t))return e.stylize("null","null")}(e,n);if(a)return a;var o=Object.keys(n),s=function(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(n)),x(n)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return h(n);if(0===o.length){if(S(n)){var l=n.name?": "+n.name:"";return e.stylize("[Function"+l+"]","special")}if(w(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(M(n))return e.stylize(Date.prototype.toString.call(n),"date");if(x(n))return h(n)}var c,b="",T=!1,P=["{","}"];(f(n)&&(T=!0,P=["[","]"]),S(n))&&(b=" [Function"+(n.name?": "+n.name:"")+"]");return w(n)&&(b=" "+RegExp.prototype.toString.call(n)),M(n)&&(b=" "+Date.prototype.toUTCString.call(n)),x(n)&&(b=" "+h(n)),0!==o.length||T&&0!=n.length?r<0?w(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),c=T?function(e,t,n,r,i){for(var a=[],o=0,s=t.length;o<s;++o)R(t,String(o))?a.push(p(e,t,n,r,String(o),!0)):a.push("");return i.forEach(function(i){i.match(/^\d+$/)||a.push(p(e,t,n,r,i,!0))}),a}(e,n,r,s,o):o.map(function(t){return p(e,n,r,s,t,T)}),e.seen.pop(),function(e,t,n){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(c,b,P)):P[0]+b+P[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,n,r,i,a){var o,s,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),R(r,i)||(o="["+i+"]"),s||(e.seen.indexOf(l.value)<0?(s=m(n)?u(e,l.value,null):u(e,l.value,n-1)).indexOf("\n")>-1&&(s=a?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),y(o)){if(a&&i.match(/^\d+$/))return s;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function f(e){return Array.isArray(e)}function d(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function v(e){return"string"==typeof e}function y(e){return void 0===e}function w(e){return b(e)&&"[object RegExp]"===T(e)}function b(e){return"object"==typeof e&&null!==e}function M(e){return b(e)&&"[object Date]"===T(e)}function x(e){return b(e)&&("[object Error]"===T(e)||e instanceof Error)}function S(e){return"function"==typeof e}function T(e){return Object.prototype.toString.call(e)}function P(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(n){if(y(a)&&(a=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!o[n])if(new RegExp("\\b"+n+"\\b","i").test(a)){var r=e.pid;o[n]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",n,r,e)}}else o[n]=function(){};return o[n]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=d,t.isNull=m,t.isNullOrUndefined=function(e){return null==e},t.isNumber=g,t.isString=v,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=y,t.isRegExp=w,t.isObject=b,t.isDate=M,t.isError=x,t.isFunction=S,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(11);var E=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function A(){var e=new Date,t=[P(e.getHours()),P(e.getMinutes()),P(e.getSeconds())].join(":");return[e.getDate(),E[e.getMonth()],t].join(" ")}function R(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",A(),t.format.apply(t,arguments))},t.inherits=n(12),t._extend=function(e,t){if(!t||!b(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var _="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function L(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(_&&e[_]){var t;if("function"!=typeof(t=e[_]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,_,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise(function(e,r){t=e,n=r}),i=[],a=0;a<arguments.length;a++)i.push(arguments[a]);i.push(function(e,r){e?n(e):t(r)});try{e.apply(this,i)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),_&&Object.defineProperty(t,_,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,r(e))},t.promisify.custom=_,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);var i=n.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var a=this,o=function(){return i.apply(a,arguments)};t.apply(this,n).then(function(t){e.nextTick(o,null,t)},function(t){e.nextTick(L,t,o)})}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,r(t)),n}}).call(this,n(10))},function(e,t){var n,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var l,c=[],u=!1,h=-1;function p(){u&&l&&(u=!1,l.length?c=l.concat(c):h=-1,c.length&&f())}function f(){if(!u){var e=s(p);u=!0;for(var t=c.length;t;){for(l=c,c=[];++h<t;)l&&l[h].run();h=-1,t=c.length}l=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new d(e,t)),1!==c.length||u||s(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";n.r(t);var r,i=n(0);n(5);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t,n,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.m=t,this.n=n,this.width=r,this.thickness=i,this.wallHeight=a,this.row=[],this.col=[],this.wall=[],this.graph=[],this.initMaze(t,n,r,i,a)}var t,n,o;return t=e,(n=[{key:"initMaze",value:function(e,t,n,a,o){this.initData(e,t);var s=new i.TextureLoader;s.crossOrigin="";var l="./texture/wall/1.jpg",c=s.load(l),u=s.load(l),h=s.load(l),p=s.load(l),f=s.load(l);c.wrapS=c.wrapT=u.wrapS=u.wrapT=h.wrapS=h.wrapT=i.RepeatWrapping,c.repeat.set(a/o,1),u.repeat.set(t,.05),h.repeat.set(t,1),f.repeat.set(1,.05);var d=[];d.push(new i.MeshPhongMaterial({map:c}),new i.MeshPhongMaterial({map:c}),new i.MeshPhongMaterial({map:u}),new i.MeshPhongMaterial({map:u}),new i.MeshPhongMaterial({map:h}),new i.MeshPhongMaterial({map:h}));var m=[];m.push(new i.MeshPhongMaterial({map:c}),new i.MeshPhongMaterial({map:c}),new i.MeshPhongMaterial({map:f}),new i.MeshPhongMaterial({map:f}),new i.MeshPhongMaterial({map:p}),new i.MeshPhongMaterial({map:p}));var g,v=new i.Mesh(new i.BoxGeometry(t*n,o,a),d),y=new i.Mesh(new i.BoxGeometry(t*n,o,a),d),w=new i.Mesh(new i.BoxGeometry(t*n,o,a),d),b=new i.Mesh(new i.BoxGeometry(t*n,o,a),d);for(w.rotation.y=b.rotation.y=Math.PI/2,v.position.set(t*n/2,o/2,0),y.position.set(t*n/2,o/2,e*n),w.position.set(0,o/2,e*n/2),b.position.set(t*n,o/2,e*n/2),r.add(v,y,w,b),this.wall.push(v,y,w,b),g=0;g<e*t;g++){var M=new Array(4);M.fill(null),g-t>=0&&(M[0]=g-t),g%t!=0&&(M[1]=g-1),g+t<e*t&&(M[2]=g+t),(g+1)%t!=0&&(M[3]=g+1),this.graph.push(M)}var x,S=new i.Mesh(new i.BoxGeometry(n,o,a),m);for(g=0;g<this.row.length;g++){(x=S.clone()).position.x=this.row[g][1]*n,x.position.z=this.row[g][0]*n+n/2,x.position.y=o/2,x.rotation.y=Math.PI/2;var T=this.row[g][1]-1+t*this.row[g][0],P=this.row[g][1]+t*this.row[g][0];x.mazeData={isRow:!0,frontPoint:T,nextPoint:P},this.wall.push(x),r.add(x),this.graph[T][this.graph[T].indexOf(P)]=null,this.graph[P][this.graph[P].indexOf(T)]=null}for(g=0;g<this.col.length;g++){(x=S.clone()).position.z=this.col[g][1]*n,x.position.x=this.col[g][0]*n+n/2,x.position.y=o/2;var E=(this.col[g][1]-1)*t+this.col[g][0],A=this.col[g][1]*t+this.col[g][0];x.mazeData={isRow:!1,frontPoint:E,nextPoint:A},this.wall.push(x),r.add(x),this.graph[E][this.graph[E].indexOf(A)]=null,this.graph[A][this.graph[A].indexOf(E)]=null}this.wall.forEach(function(e){e.traverse(function(e){e instanceof i.Mesh&&(e.castShadow=e.receiveShadow=!0)})})}},{key:"initData",value:function(e,t){for(var n=[],r=[],i=0;i<e*t;i++)n.push(i);for(var a=0;a<e;a++)for(var o=1;o<t;o++)r.push([0,a,o]);for(var s=0;s<t;s++)for(var l=1;l<e;l++)r.push([1,s,l]);for(var c=0;r.length>0;){var u=Math.floor(r.length*Math.random()),h=void 0,p=void 0;0===r[u][0]?(h=r[u][1]*t+r[u][2]-1,p=r[u][1]*t+r[u][2]):(h=(r[u][2]-1)*t+r[u][1],p=r[u][2]*t+r[u][1]),-1!==n[h]&&-1!==n[p]&&d(h,p)||(0===r[u][0]?this.row.push([r[u][1],r[u][2]]):this.col.push([r[u][1],r[u][2]]),c++);var f=r[u];r[u]=r[r.length-1],r[r.length-1]=f,r.pop()}function d(e,t){var r=m(e),i=m(t);return r!==i&&(n[i]=r,!0)}function m(e){return e==n[e]?e:n[e]=m(n[e])}console.log(c),console.log("牆密度為"+c/(t*(e-1)+e*(t-1)))}},{key:"removeWall",value:function(e){var t=e.frontPoint,n=e.nextPoint,r=Math.floor(t/this.n),i=t%this.n+1;if(n-t==1){var a;for(a=0;a<this.row.length&&(this.row[a][0]!==r||this.row[a][1]!==i);a++);this.row.splice(a,1)}else{var o;for(o=0;o<this.col.length&&(this.col[o][0]!==r||this.col[o][1]!==i);o++);this.col.splice(o,1)}return this.pushInGraph(t,n),void this.pushInGraph(n,t)}},{key:"check",value:function(e,t){return!(this.graph[e].indexOf(t)<0)}},{key:"getNodeToPos",value:function(e){var t=e%this.n*this.width+this.width/2,n=Math.floor(e/this.n)*this.width+this.width/2;return new i.Vector3(t,0,n)}},{key:"pushInGraph",value:function(e,t){e-this.n===t?this.graph[e][0]=t:e-1===t?this.graph[e][1]=t:e+this.n===t?this.graph[e][2]=t:e+1===t?this.graph[e][3]=t:console.log("pushInGraph function Error!!!")}}])&&a(t.prototype,n),o&&a(t,o),e}(),s=function e(){document.addEventListener("keydown",e.onKeyDown,!1),document.addEventListener("keyup",e.onKeyUp,!1)};s.k={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",219:"[",220:"\\",221:"]",222:"'"},s.status={},s.keyName=function(e){return null!=s.k[e]?s.k[e]:String.fromCharCode(e)},s.onKeyUp=function(e){e.preventDefault();var t=s.keyName(e.keyCode);s.status[t]&&(s.status[t].pressed=!1)},s.onKeyDown=function(e){e.preventDefault();var t=s.keyName(e.keyCode);s.status[t]||(s.status[t]={down:!1,pressed:!1,up:!1,updatedPreviously:!1})},s.prototype.update=function(){for(var e in s.status)s.status[e].updatedPreviously?s.status[e].down=!1:(s.status[e].down=!0,s.status[e].pressed=!0,s.status[e].updatedPreviously=!0),s.status[e].up?delete s.status[e]:s.status[e].pressed||(s.status[e].up=!0)},s.prototype.down=function(e){return s.status[e]&&s.status[e].down},s.prototype.pressed=function(e){return s.status[e]&&s.status[e].pressed},s.prototype.up=function(e){return s.status[e]&&s.status[e].up},s.prototype.debug=function(){var e="Keys active: ";for(var t in s.status)e+=" "+t;console.log(e)};var l=s,c=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var r=n(1);t.SpriteText2D=r.SpriteText2D;var i=n(6);t.MeshText2D=i.MeshText2D;var a=n(4);t.textAlign=a.textAlign},function(e,t,n){var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=n(2),a=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.raycast=function(){return this.sprite.raycast.apply(this.sprite,arguments)},t.prototype.updateText=function(){this.canvas.drawText(this._text,{font:this._font,fillStyle:this._fillStyle}),this.cleanUp(),this.texture=new i.Texture(this.canvas.canvas),this.texture.needsUpdate=!0,this.applyAntiAlias(),this.material?this.material.map=this.texture:this.material=new i.SpriteMaterial({map:this.texture}),this.sprite||(this.sprite=new i.Sprite(this.material),this.geometry=this.sprite.geometry,this.add(this.sprite)),this.sprite.scale.set(this.canvas.width,this.canvas.height,1),this.sprite.position.x=this.canvas.width/2-this.canvas.textWidth/2+this.canvas.textWidth/2*this.align.x,this.sprite.position.y=-this.canvas.height/2+this.canvas.textHeight/2*this.align.y},t}(n(3).Text2D);t.SpriteText2D=a},function(e,t){e.exports=i},function(e,t,n){var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=n(2),a=n(4),o=n(5),s=function(e){function t(t,n){void 0===t&&(t=""),void 0===n&&(n={}),e.call(this),this._font=n.font||"30px Arial",this._fillStyle=n.fillStyle||"#FFFFFF",this.canvas=new o.CanvasText,this.align=n.align||a.textAlign.center,this.side=n.side||i.DoubleSide,this.antialias=void 0===n.antialias||n.antialias,this.text=t}return r(t,e),Object.defineProperty(t.prototype,"width",{get:function(){return this.canvas.textWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.canvas.textHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(e){this._text!==e&&(this._text=e,this.updateText())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"font",{get:function(){return this._font},set:function(e){this._font!==e&&(this._font=e,this.updateText())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fillStyle",{get:function(){return this._fillStyle},set:function(e){this._fillStyle!==e&&(this._fillStyle=e,this.updateText())},enumerable:!0,configurable:!0}),t.prototype.cleanUp=function(){this.texture&&this.texture.dispose()},t.prototype.applyAntiAlias=function(){!1===this.antialias&&(this.texture.magFilter=i.NearestFilter,this.texture.minFilter=i.LinearMipMapLinearFilter)},t}(i.Object3D);t.Text2D=s},function(e,t,n){var r=n(2);t.textAlign={center:new r.Vector2(0,0),left:new r.Vector2(1,0),topLeft:new r.Vector2(1,-1),topRight:new r.Vector2(-1,-1),right:new r.Vector2(-1,0),bottomLeft:new r.Vector2(1,1),bottomRight:new r.Vector2(-1,1)};var i={};t.getFontHeight=function(e){var t=i[e];if(!t){var n=document.getElementsByTagName("body")[0],r=document.createElement("div"),a=document.createTextNode("MEq");r.appendChild(a),r.setAttribute("style","font:"+e+";position:absolute;top:0;left:0"),n.appendChild(r),t=r.offsetHeight,i[e]=t,n.removeChild(r)}return t}},function(e,t,n){var r=n(2),i=n(4),a=function(){function e(){this.textWidth=null,this.textHeight=null,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}return Object.defineProperty(e.prototype,"width",{get:function(){return this.canvas.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.canvas.height},enumerable:!0,configurable:!0}),e.prototype.drawText=function(e,t){return this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.font=t.font,this.textWidth=Math.ceil(this.ctx.measureText(e).width),this.textHeight=i.getFontHeight(this.ctx.font),this.canvas.width=r.Math.ceilPowerOfTwo(this.textWidth),this.canvas.height=r.Math.ceilPowerOfTwo(this.textHeight),this.ctx.font=t.font,this.ctx.fillStyle=t.fillStyle,this.ctx.textAlign="left",this.ctx.textBaseline="top",this.ctx.fillText(e,0,0),this.canvas},e}();t.CanvasText=a},function(e,t,n){var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=n(2),a=function(e){function t(t,n){void 0===t&&(t=""),void 0===n&&(n={}),e.call(this,t,n)}return r(t,e),t.prototype.raycast=function(){this.mesh.raycast.apply(this.mesh,arguments)},t.prototype.updateText=function(){this.cleanUp(),this.canvas.drawText(this._text,{font:this._font,fillStyle:this._fillStyle}),this.texture=new i.Texture(this.canvas.canvas),this.texture.needsUpdate=!0,this.applyAntiAlias(),this.material?this.material.map=this.texture:(this.material=new i.MeshBasicMaterial({map:this.texture,side:this.side}),this.material.transparent=!0),this.mesh||(this.geometry=new i.PlaneGeometry(this.canvas.width,this.canvas.height),this.mesh=new i.Mesh(this.geometry,this.material),this.add(this.mesh)),this.mesh.position.x=this.canvas.width/2-this.canvas.textWidth/2+this.canvas.textWidth/2*this.align.x,this.mesh.position.y=-this.canvas.height/2+this.canvas.textHeight/2*this.align.y,this.geometry.vertices[0].x=this.geometry.vertices[2].x=-this.canvas.width/2,this.geometry.vertices[1].x=this.geometry.vertices[3].x=this.canvas.width/2,this.geometry.vertices[0].y=this.geometry.vertices[1].y=this.canvas.height/2,this.geometry.vertices[2].y=this.geometry.vertices[3].y=-this.canvas.height/2,this.geometry.verticesNeedUpdate=!0},t}(n(3).Text2D);t.MeshText2D=a}]);function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.start=null,this.end=null}var t,n,r;return t=e,(n=[{key:"update",value:function(){var e=this.end.clone().sub(this.start).multiplyScalar(.08);return e=this.start.clone().add(e)}}])&&u(t.prototype,n),r&&u(t,r),e}();function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nowCell=o,this.width=10,this.model=n,this.text=null,this.body=this.buildBody(n,a),this.maze=t,this.rot=Math.PI/2,this.speed=0,this.camera=s,this.animateKey=new h,this.cameraLookPoint=new i.Object3D,this.cameraLookPoint.position.set(50,10,0),this.body.add(this.cameraLookPoint),this.state={stateName:"Normal",keepTime:1/0},s&&(s.position.set(-80,70,0),s.lookAt(this.cameraLookPoint.getWorldPosition(new i.Vector3)),this.body.add(s)),this.body.position.copy(this.maze.getNodeToPos(o)),r.add(this.body)}var t,n,a;return t=e,(n=[{key:"changeText",value:function(e){this.body.remove(this.text),r.remove(this.text),this.text=new c.SpriteText2D("  "+e,{align:c.textAlign.center,font:"40px Arial",fillStyle:"#ff0000",antialias:!0}),this.text.position.set(0,60,0),this.text.scale.set(.5,.5,.5),r.add(this.text),this.body.add(this.text)}},{key:"buildBody",value:function(e,t){var n=new i.Object3D,r=(new i.TextureLoader).load("./texture/soft_shadow.png"),a=new i.Mesh(new i.PlaneGeometry(15.5,15.5),new i.MeshBasicMaterial({map:r,transparent:!0}));return a.rotation.x=-Math.PI/2,a.position.y=3,n.add(e.body),n.add(a),void 0!==this.model.actions.Running?(this.activeAction=this.model.actions.Running,e.body.scale.set(5,5,5),e.body.rotation.y=Math.PI/2):(this.activeAction=this.model.actions.Run,e.body.scale.set(25,25,25),e.body.rotation.y=-Math.PI/2),this.activeAction.play(),null!==t&&(this.text=new c.SpriteText2D("  "+t,{align:c.textAlign.center,font:"40px Arial",fillStyle:"#ff0000",antialias:!0}),this.text.position.set(0,60,0),this.text.scale.set(.5,.5,.5),n.add(this.text)),n.traverse(function(e){e instanceof i.Mesh&&(e.castShadow=e.receiveShadow=!0)}),n}},{key:"update",value:function(e,t,n){this.model.mixer.update(e),"Normal"===this.state.stateName?this.normalUpdate(t,n):"Dead"===this.state.stateName&&(this.state.keepTime<0?(this.state.stateName="Normal",this.state.keepTime=1/0):this.state.keepTime<1?(this.fadeToAction("Idle",1),this.state.keepTime-=e):(this.fadeToAction("Death",.5),this.state.keepTime-=e))}},{key:"normalUpdate",value:function(e,t){var n=this.body.position.clone(),r="Idle";if(e.pressed("right")&&(this.rot-=.06,r="Walking"),e.pressed("left")&&(this.rot+=.06,r="Walking"),e.pressed("up")&&(n=this.body.position.clone().add(new i.Vector3(2,0,0).applyAxisAngle(new i.Vector3(0,1,0),this.rot)),r="Running"),e.pressed("down")&&(n=this.body.position.clone().add(new i.Vector3(-2,0,0).applyAxisAngle(new i.Vector3(0,1,0),this.rot)),r="Running"),null!==this.model&&this.fadeToAction(r,.15),this.body.rotation.y=this.rot,this.checkNextPos(n)){this.body.position.copy(n);var a=Math.floor(n.x/this.maze.width),o=Math.floor(n.z/this.maze.width);this.nowCell=o*this.maze.n+a}if(this.camera){this.animateKey.start=this.camera.position.clone(),this.camera.position.set(-80,70,0);var s=new i.Raycaster(this.camera.getWorldPosition(new i.Vector3),this.body.position.clone().sub(this.camera.getWorldPosition(new i.Vector3)).normalize());s.far=this.camera.position.length();var l=s.intersectObjects(t),c=new i.Vector3(-80,70,0);if(l.length>0){c.sub(new i.Vector3(-80,70,0).normalize().multiplyScalar(l[l.length-1].distance));var u=c.x,h=c.z,p=new i.Vector3(-80,70,0).length();c.y=Math.sqrt(p*p-(u*u+h*h))}this.animateKey.end=c,this.camera.position.copy(this.animateKey.update()),this.camera.lookAt(this.cameraLookPoint.getWorldPosition(new i.Vector3))}}},{key:"fadeToAction",value:function(e,t){this.previousAction!=this.model.actions[e]&&(this.previousAction=this.activeAction,this.activeAction=this.model.actions[e],this.previousAction.fadeOut(t),this.activeAction.reset().setEffectiveTimeScale(1).setEffectiveWeight(1).fadeIn(t).play())}},{key:"checkNextPos",value:function(e){var t=this.maze.width*this.maze.n,n=this.maze.width*this.maze.m;if(e.x>=0+this.width&&e.z>=0+this.width&&e.x<=t-this.width&&e.z<=n-this.width){for(var r=[[1,0],[0,1],[-1,0],[0,-1]],i=0;i<4;i++){var a=Math.floor((e.x+r[i][0]*this.width)/this.maze.width),o=Math.floor((e.z+r[i][1]*this.width)/this.maze.width)*this.maze.n+a;if((Math.abs(o-this.nowCell)<=1||Math.abs(o-this.nowCell)%this.maze.n==0)&&o!==this.nowCell&&!this.maze.check(o,this.nowCell))return console.log(o+" "+this.nowCell),!1}return!0}return!1}}])&&p(t.prototype,n),a&&p(t,a),e}();function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.centerMaxSize=1e3,this.centerSet=new Array(this.centerMaxSize),this.centerSet3=new Array(this.centerMaxSize),this.nowCenterSet=0;for(var n=0;n<this.centerMaxSize;n++)this.centerSet[n]=new i.Vector2,this.centerSet3[n]=new i.Vector3;this.initHUD(t),this.initScrene(),this.time=60}var t,n,r;return t=e,(n=[{key:"initHUD",value:function(e){e/=2;var t=window.innerWidth,n=window.innerHeight;this.sceneHUD=new i.Scene,this.initSceneHUD(t,n),this.cameraHUD1=new i.OrthographicCamera(-t/2,t/2,n/2,-n/2,1,50),this.cameraHUD2=new i.OrthographicCamera(-t/6,t/6,n/6,-n/6,-50,350),this.cameraHUD3=new i.OrthographicCamera(-e,e,e,-e,-50,350),this.cameraHUD2.position.set(e,15,e),this.cameraHUD2.up.set(1,0,0),this.cameraHUD2.lookAt(new i.Vector3(e,0,e)),this.cameraHUD1.position.set(0,0,10),this.cameraHUD3.up.set(1,0,0),this.cameraHUD3.position.set(e,15,e),this.cameraHUD3.lookAt(new i.Vector3(e,0,e));var r=window.innerWidth/2,a=window.innerHeight/2;this.sceneMinimapHUD=new i.Scene,this.cameraMinimapHUD=new i.OrthographicCamera(-r-.5,r+.5,a+.5,-a-.5,1,10),this.cameraMinimapHUD.position.z=5;var o=new i.Geometry;o.vertices.push(new i.Vector3(-r,-a,0),new i.Vector3(r,-a,0),new i.Vector3(r,a,0),new i.Vector3(-r,a,0),new i.Vector3(-r,-a,0));var s=new i.Line(o,new i.LineBasicMaterial({color:16777215}));this.sceneMinimapHUD.add(s)}},{key:"initSceneHUD",value:function(e,t){var n=(new i.TextureLoader).load("./texture/bomb.png"),r=new i.Mesh(new i.PlaneGeometry(80,80),new i.MeshBasicMaterial({transparent:!0,map:n}));r.position.set(-e/32*15,-t/16*7,0),this.sceneHUD.add(r),this.planeTimeMat=new i.ShaderMaterial({uniforms:{color:{type:"v3",value:new i.Vector3(0,1,0)},pos:{type:"f",value:-(e/4-70)}},vertexShader:"varying vec4 myeyepos;\r\nvoid main() { \r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n    myeyepos = vec4(position,1.0);\r\n}\r\n\r\n",fragmentShader:"varying vec4 myeyepos;\r\nuniform float pos;\r\nuniform vec3 color;\r\nvoid main() { \r\n    vec4 mycolor;\r\n    if(myeyepos.x < pos)\r\n    mycolor = vec4(color,1);\r\n    else\r\n    mycolor = vec4(0.0, 0.0, 0.0, 0.0);\r\n    \r\n    gl_FragColor = mycolor; \r\n}"});var a=new i.Mesh(new i.PlaneGeometry(2*(e/4-70),40),this.planeTimeMat);a.position.set(-e/32*8,-t/16*7,0),this.sceneHUD.add(a)}},{key:"initScrene",value:function(){this.sceneScrene=new i.Scene,this.cameraScrene=new i.OrthographicCamera(-150,150,150,-150,-10,10),this.rtTexture=new i.WebGLRenderTarget(.3*window.innerWidth,.3*window.innerHeight,{minFilter:i.LinearFilter,magFilter:i.NearestFilter,format:i.RGBFormat}),this.rttmaterial=new i.ShaderMaterial({uniforms:{minRange:{type:"f",value:30},maxRange:{type:"f",value:125},texture:{type:"t",value:this.rtTexture},center:{type:"v2v",value:this.centerSet}},vertexShader:"varying vec2 vUv;\r\nvoid main() {\r\n    gl_Position = projectionMatrix* modelViewMatrix * vec4( position, 1.0);\r\n    vUv = uv;\r\n}",fragmentShader:"#define CENTER_MAX  "+this.centerMaxSize+"\nuniform sampler2D texture;\r\nvarying vec2 vUv;\r\nuniform vec2 center[CENTER_MAX];\r\nuniform float minRange, maxRange;\r\n\r\nvoid main() {\r\n    vec4 color;\r\n    \r\n    float dis;\r\n\r\n    float opacity = 0.0;\r\n    float nowOpacity = 0.0;\r\n\r\n    for(int i = 0; i < CENTER_MAX; i++){\r\n        dis = distance (gl_FragCoord.st, center[i]);\r\n\r\n        if (dis < minRange)  \r\n            nowOpacity = 1.0;\r\n        else if(dis < maxRange)\r\n            nowOpacity = 1.0 - ((dis - minRange) / (maxRange - minRange));\r\n        \r\n        opacity = opacity > nowOpacity ? opacity : nowOpacity;\r\n    }\r\n\r\n    color = texture2D (texture, vUv) * opacity;\r\n    \r\n\r\n    gl_FragColor = color;\r\n}"});var e=new i.PlaneBufferGeometry(300,300),t=new i.Mesh(e,this.rttmaterial);this.sceneScrene.add(t)}},{key:"updateTime",value:function(e){this.time-=e,this.planeTimeMat.uniforms.pos.value=window.innerWidth/4-70+-2*(window.innerWidth/4-70)*(60-this.time)/60,this.time<10?this.planeTimeMat.uniforms.color.value.set(1,0,0):this.planeTimeMat.uniforms.color.value.set(0,1,0)}},{key:"updateMiniMapPos",value:function(e,t,n){this.cameraHUD2.position.set(e,15,t),this.cameraHUD2.rotation.z=n+Math.PI/2*3}},{key:"updateCenter",value:function(e,t,n,r,a){var o,s,l=.5,c=.5;this.centerSet3[this.nowCenterSet].set(e,0,t);for(var u=0;u<this.centerMaxSize;u++){var h=this.centerSet3[u].clone(),p=new i.Vector3(e,0,t);if(a){var f=h.sub(new i.Vector3(r.n*r.width/2,0,r.m*r.width/2));l=f.z/(r.n*r.width)+.5,c=f.x/(r.m*r.width)+.5,o=window.innerHeight*l+.5*(window.innerWidth-window.innerHeight),s=window.innerHeight*c,this.rttmaterial.uniforms.minRange.value=20,this.rttmaterial.uniforms.maxRange.value=100}else{var d=h.clone().sub(p).applyAxisAngle(new i.Vector3(0,1,0),-n);l=d.z/(window.innerWidth/3)+.5,c=d.x/(window.innerHeight/3)+.5,o=.3*window.innerWidth*l+.7*window.innerWidth,s=.3*window.innerHeight*c,this.rttmaterial.uniforms.minRange.value=30,this.rttmaterial.uniforms.maxRange.value=125}this.rttmaterial.uniforms.center.value[u].copy(new i.Vector2(o,s))}this.nowCenterSet++,this.nowCenterSet%=this.centerMaxSize}}])&&d(t.prototype,n),r&&d(t,r),e}();n(6);function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var M,x,S,T,P,E,A,R,_,L,N,O=function(e){function t(e,n,r,a,o){var s,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=y(this,w(t).call(this,e,n,r,o))).NPCStateTable=Object.freeze({initState:1,findNextPoint:2,GoToPoint:3,WaintingTarget:4}),s.NPCState=s.NPCStateTable.initState,s.isTraverse=new Array(e.m*e.n),s.targetNode=new i.Vector3,s.target=l,s.catchMode=!1,s.stackPath=[],s.frontNode=-1,s.speed=120,s.traversMode=a,s.traversModeConst=a,s.traversModeTable=Object.freeze({left:0,right:1,random:2,Astar_Manhattan:3,Astar_Euclidean:4,Astar_Breaking:5,Astar_Max:6}),s.AstarPath=[],s.waitingTime=0,s.camera=c,c&&(c.position.set(s.body.position.x,400,s.body.position.z),c.lookAt(s.body.getWorldPosition(new i.Vector3))),s}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,f),n=t,(r=[{key:"findNextPoint_Random",value:function(){this.isTraverse[this.nowCell]=!0;for(var e,t=!1,n=0;n<this.maze.graph[this.nowCell].length;n++)if(null!==this.maze.graph[this.nowCell][n]&&!this.isTraverse[this.maze.graph[this.nowCell][n]]){this.stackPath.push(this.nowCell),e=this.maze.graph[this.nowCell][n],t=!0;break}return!(!t&&0==this.stackPath.length)&&(t||(e=this.stackPath[this.stackPath.length-1],this.stackPath.pop()),this.target=e,this.targetNode.copy(this.maze.getNodeToPos(e)),!0)}},{key:"findNextPoint_Left",value:function(){var e;e=(this.maze.graph[this.nowCell].indexOf(this.frontNode)+3)%4;for(var t=0;t<4&&null===this.maze.graph[this.nowCell][e];t++,e=(e+3)%4);return this.frontNode=this.nowCell,this.target=this.maze.graph[this.nowCell][e],this.targetNode.copy(this.maze.getNodeToPos(this.target)),!0}},{key:"findNextPoint_Right",value:function(){var e;e=(this.maze.graph[this.nowCell].indexOf(this.frontNode)+1)%4;for(var t=0;t<4&&null===this.maze.graph[this.nowCell][e];t++,e=(e+1)%4);return this.frontNode=this.nowCell,this.target=this.maze.graph[this.nowCell][e],this.targetNode.copy(this.maze.getNodeToPos(this.target)),!0}},{key:"GoToPoint",value:function(e){var t=this.targetNode.clone().sub(this.body.position).normalize().multiplyScalar(e*this.speed);return this.body.position.add(t),this.body.rotation.y=Math.acos(t.x/t.length()),t.z>0&&(this.body.rotation.y*=-1),this.targetNode.clone().sub(this.body.position).length()<10&&(this.nowCell=this.target,!0)}},{key:"Hfunction_ref",value:function(e,t,n){switch(n){case"Manhattan":return Math.abs(Math.floor(this.target/this.maze.n)-Math.floor(this.maze.graph[e.NodeName][t]/this.maze.n))+Math.abs(this.target%this.maze.n-this.maze.graph[e.NodeName][t]%this.maze.n);case"Euclidean":return this.maze.getNodeToPos(this.maze.graph[e.NodeName][t]).sub(this.maze.getNodeToPos(this.target)).length();case"Breaking":return Math.max(Math.abs(Math.floor(this.target/this.maze.n)-Math.floor(this.maze.graph[e.NodeName][t]/this.maze.n)),Math.abs(this.target%this.maze.n-this.maze.graph[e.NodeName][t]%this.maze.n))}}},{key:"initAstarPath",value:function(e){this.AstarPath=[],(new i.Clock).start();var t=[],n=[];t.push({NodeName:this.nowCell,NodeValue:0,Parent:-1});for(;t.length>0;){for(var r=t[0],a=0,o=1;o<t.length;o++)r.NodeValue>t[o].NodeValue&&(r=t[o],a=o);var s=t[t.length-1];if(t[t.length-1]=t[a],t[a]=s,t.pop(),n.push(r),r.NodeName===this.target){for(var l=this.target,c=n.length-1;c>=0;){for(;c>=0&&n[c].NodeName!==l;)c--;if(l===this.nowCell)break;this.AstarPath.push(l),l=n[c].Parent}return}for(var u=0;u<4;u++)if(null!==this.maze.graph[r.NodeName][u]){var h=this.maze.getNodeToPos(this.maze.graph[r.NodeName][u]).sub(this.maze.getNodeToPos(0)).length(),p=this.Hfunction_ref(r,u,e);p*=this.maze.width;for(var f=!1,d=0;d<t.length;d++)t[d].NodeName===this.maze.graph[r.NodeName][u]&&(f=!0,t[d].NodeValue=t[d].NodeValue>h+p?h+p:t[d].NodeValue);for(var m=0;m<n.length;m++)n[m].NodeName===this.maze.graph[r.NodeName][u]&&(f=!0);if(!f){var g={NodeName:this.maze.graph[r.NodeName][u],NodeValue:h+p,Parent:r.NodeName};t.push(g),0}}}}},{key:"findNextPoint_Astar",value:function(){return 0!==this.AstarPath.length&&(this.frontNode=this.target,this.target=this.AstarPath.pop(),this.targetNode.copy(this.maze.getNodeToPos(this.target)),!0)}},{key:"findPlayer",value:function(e,t,n){var r=t-e,i=e;if(1===r||-1===r)for(var a=Math.floor(e/this.maze.n)*this.maze.n,o=i+r;o>=a&&o<a+this.maze.n;o+=r){if(!this.maze.check(i,o))return!1;if(n===o)return!0;i=o}else for(var s=i+r;s<this.maze.n*this.maze.m&&s>=0;s+=r){if(!this.maze.check(i,s))return!1;if(n===s)return!0;i=s}return!1}},{key:"update",value:function(e,t){var n;switch(this.NPCState){case this.NPCStateTable.initState:switch(this.traversMode){case this.traversModeTable.Astar_Manhattan:this.initAstarPath("Manhattan");break;case this.traversModeTable.Astar_Euclidean:this.initAstarPath("Euclidean");break;case this.traversModeTable.Astar_Breaking:this.initAstarPath("Breaking");break;default:this.isTraverse.fill(!1),this.isTraverse[this.nowCell]=!0}this.NPCState=this.NPCStateTable.findNextPoint;case this.NPCStateTable.findNextPoint:switch(this.traversMode){case this.traversModeTable.left:n=this.findNextPoint_Left();break;case this.traversModeTable.right:n=this.findNextPoint_Right();break;case this.traversModeTable.Astar_Manhattan:case this.traversModeTable.Astar_Euclidean:case this.traversModeTable.Astar_Breaking:n=this.findNextPoint_Astar()}if(!n){this.traversMode>=3?this.catchMode?(this.target=t,this.NPCState=this.NPCStateTable.initState):this.NPCState=this.NPCStateTable.WaintingTarget:this.NPCState=this.NPCStateTable.initState;break}this.NPCState=this.NPCStateTable.GoToPoint;case this.NPCStateTable.GoToPoint:if((n=this.findPlayer(this.frontNode,this.target,t))&&!this.catchMode){this.changeText("!"),this.traversMode=this.traversModeTable.Astar_Manhattan,this.target=t,this.NPCState=this.NPCStateTable.initState,this.catchMode=!0;break}(n=this.GoToPoint(e))&&(this.NPCState=this.NPCStateTable.findNextPoint)}this.camera&&this.camera.position.set(this.body.position.x,400,this.body.position.z),null!==this.model&&(void 0!==this.model.actions.Running?this.fadeToAction("Running",.15):this.fadeToAction("Run",.15),this.model.mixer.update(e))}}])&&v(n.prototype,r),a&&v(n,a),t}(),C=n(4),D=n.n(C),k=n(2),U=n.n(k),I=n(3),j=n.n(I),H={},F=0,z=new D.a,G="Init",B=0,V=new i.Raycaster,W=new i.Vector2,K=[],q=[],X=new l,Y=70,J=15,Z=1500,$=!1,Q=[];U()("#StartGame").click(function(e){1==F&&(!function(){document.getElementById("InitGame").style.display="none",document.getElementById("InGame").style.display="inline",B=0,x.far=550,x.updateProjectionMatrix(),P.wall.forEach(function(e){K.push(e)}),R=new f(P,H,null,0,x),E=new m(Y*J),r.remove(L),r.remove(_.body);var e=(new i.TextureLoader).load("./texture/FinalLine.png");L=new i.Mesh(new i.PlaneGeometry(100,200),new i.MeshBasicMaterial({map:e,transparent:!0,side:i.DoubleSide})),A=Math.floor(Math.random()*J*J),L.position.copy(P.getNodeToPos(A)),L.position.y=50,r.add(L),(q=[]).push(new O(P,M[2],"NPC3",3,A,Math.floor(Math.random()*J*J)),new O(P,M[3],"NPC4",4,A,Math.floor(Math.random()*J*J)))}(),G="Game")}),U()("#BackGame").click(function(e){!function(){document.getElementById("EndGame").style.display="none",document.getElementById("InitGame").style.display="inline",K=[],R.body.remove(x),x.position.set(J*Y/2,150,J*Y/2),x.lookAt(new i.Vector3),r.add(x),P.wall.forEach(function(e){r.remove(e)}),r.remove(R.body),q.forEach(function(e){r.remove(e.body)}),q=[],r.remove(L),P=new o(J,J,Y,5,50),x.far=550,x.updateProjectionMatrix();var e=Math.floor(Math.random()*J*J);(_=new O(P,H,"",3,0,e,x)).speed=120;var t=(new i.TextureLoader).load("./texture/FinalLine.png");L=new i.Mesh(new i.PlaneGeometry(50,50),new i.MeshBasicMaterial({map:t,transparent:!0,side:i.DoubleSide})),A=Math.floor(Math.random()*J*J),L.position.copy(P.getNodeToPos(A)),L.position.y=5,L.rotation.x=-Math.PI/2,_.target=A,r.add(L)}(),G="Init"}),window.addEventListener("resize",function(){var e=window.innerWidth,t=window.innerHeight;x.aspect=e/t,x.updateProjectionMatrix(),S.setSize(e,t)},!1),document.addEventListener("mousedown",function(e){e.preventDefault(),W.x=e.clientX/window.innerWidth*2-1,W.y=-e.clientY/window.innerHeight*2+1,V.setFromCamera(W,x);var t=V.intersectObjects(K);t.length>0&&(console.log(t[0]),"mazeData"in t[0].object&&(K.splice(K.indexOf(t[0].object),1),Q.push(t[0].object)))},!1);var ee=[];ee.push(new Promise(function(e,t){(new j.a).load("./model/RobotExpressive.glb",function(t){console.log("load complete"),e(t)},function(e){console.log(e.loaded/e.total*100+"% loaded")},function(e){t(e)})}));for(var te=0;te<5;te++)ee.push(new Promise(function(e,t){(new j.a).load("./model/Soldier.glb",function(t){console.log("load complete"),e(t)},function(e){console.log(e.loaded/e.total*100+"% loaded")},function(e){t(e)})}));function ne(e){"Game"===G&&(B+=e),X.up("M")&&($=!$),$||(R.update(e,X,K),q.forEach(function(t){t.update(e,R.nowCell),t.NPCState===t.NPCStateTable.WaintingTarget&&(t.target=Math.floor(Math.random()*J*J),t.NPCState=t.NPCStateTable.initState)}),R.nowCell===A&&(G="End"),q.forEach(function(e){R.nowCell===e.nowCell&&"Dead"!==R.state.stateName&&(R.state.stateName="Dead",R.state.keepTime=3,e.catchMode=!1,e.NPCState=e.NPCStateTable.WaintingTarget,e.changeText(""))}))}function re(){var e=T.getDelta();if(z.update(),X.update(),"Init"===G)!function(e){if(_.update(e),_.NPCState===_.NPCStateTable.WaintingTarget){r.remove(L);var t=(new i.TextureLoader).load("./texture/FinalLine.png");L=new i.Mesh(new i.PlaneGeometry(50,50),new i.MeshBasicMaterial({map:t,transparent:!0,side:i.DoubleSide})),A=Math.floor(Math.random()*J*J),L.position.copy(P.getNodeToPos(A)),L.position.y=5,L.rotation.x=-Math.PI/2,r.add(L),_.target=A,_.NPCState=_.NPCStateTable.initState}}(e);else if("Game"===G){ne(e);var t=R.body.getWorldPosition(new i.Vector3).clone().sub(L.getWorldPosition(new i.Vector3));t.y=0;var n=Math.atan2(t.x,t.z);L.rotation.y=n,B>60&&(G="End",$=!1)}else"End"===G&&(ne(e),document.getElementById("InGame").style.display="none",document.getElementById("EndGame").style.display="inline",document.getElementById("EndInfo").innerHTML="遊戲結束！ 花費時間為 "+Math.floor(B/60)+"分 "+Math.floor(B%60)+"秒");requestAnimationFrame(re),function(e){var t=window.innerWidth,n=window.innerHeight;if(S.setScissorTest(!0),S.setViewport(0,0,t,n),S.setScissor(0,0,t,n),S.clear(),S.render(r,x),"Game"===G){S.render(E.sceneHUD,E.cameraHUD1);var i=R.body.position.clone();if(Q.length>0)for(var a=Q.length,o=0;o<a;){var s=!1;Q[o].position.y-=.8,Q[o].position.y<-25?(r.remove(Q[o]),P.removeWall(Q[o].mazeData),s=!0,a--):o++,s&&Q.shift()}$?(S.setViewport(.5*(t-n),0,n,n),S.setScissor(.5*(t-n),0,n,n),S.clear(),S.render(E.sceneMinimapHUD,E.cameraMinimapHUD),S.setRenderTarget(E.rtTexture),S.render(r,E.cameraHUD3),E.updateMiniMapPos(i.x,i.z,R.body.rotation.y),E.updateCenter(i.x,i.z,R.body.rotation.y,P,$),S.setRenderTarget(null),S.render(E.sceneScrene,E.cameraScrene)):(S.setViewport(.7*t,0,.3*t,.3*n),S.setScissor(.7*t,0,.3*t,.3*n),S.clear(),S.render(E.sceneMinimapHUD,E.cameraMinimapHUD),S.setRenderTarget(E.rtTexture),S.render(r,E.cameraHUD2),E.updateMiniMapPos(i.x,i.z,R.body.rotation.y),E.updateCenter(i.x,i.z,R.body.rotation.y,P,$),S.setRenderTarget(null),S.render(E.sceneScrene,E.cameraScrene)),E.updateTime(e)}}(e)}Promise.all(ee).then(function(e){console.log(e),F=1,function(e){H.body=e.scene,H.actions={},H.mixer=new i.AnimationMixer(e.scene),H.states=["Idle","Walking","Running","Dance","Death","Sitting","Standing"],H.emotes=["Jump","Yes","No","Wave","Punch","ThumbsUp"];for(var t=0;t<e.animations.length;t++){var n=e.animations[t],r=H.mixer.clipAction(n);H.actions[n.name]=r,(H.emotes.indexOf(n.name)>=0||H.states.indexOf(n.name)>=4)&&(r.clampWhenFinished=!0,r.loop=i.LoopOnce)}}(e[0]),e.shift(),function(e){M=new Array(e.length);for(var t=0;t<e.length;t++){M[t]={},M[t].body=e[t].scene,M[t].actions={},M[t].mixer=new i.AnimationMixer(e[t].scene),M[t].states=["Idle","Run","TPose","Walk"];for(var n=0;n<e[t].animations.length;n++){var r=e[t].animations[n],a=M[t].mixer.clipAction(r);M[t].actions[r.name]=a}}}(e),function(){r=new i.Scene,r.background=new i.Color(2236962),z.domElement.style.position="absolute",z.domElement.style.top="0px",z.domElement.style.zIndex=100,document.body.appendChild(z.domElement),T=new i.Clock,(x=new i.PerspectiveCamera(50,window.innerWidth/window.innerHeight,10,Z)).position.set(J*Y/2,500,J*Y/2),x.lookAt(new i.Vector3),r.add(x),(S=new i.WebGLRenderer({antialias:!0})).setSize(window.innerWidth,window.innerHeight),S.setClearColor(8947848),S.autoClear=!1,document.body.appendChild(S.domElement),P=new o(J,J,Y,5,50),(N=new i.DirectionalLight(11184810)).position.set(Y*J/2+50,200,Y*J/2+50),N.target.position.set(Y*J/2,0,Y*J/2),r.add(N.target),r.add(N,new i.AmbientLight(4473924));var e=new i.TextureLoader;e.crossOrigin="",e.load("./texture/road/418-418.jpg",function(e){e.wrapS=e.wrapT=i.RepeatWrapping,e.repeat.set(J,J);var t=new i.Mesh(new i.PlaneGeometry(Y*J,Y*J),new i.MeshPhongMaterial({map:e}));t.rotation.x=-Math.PI/2,t.position.set(Y*J/2,0,Y*J/2),t.receiveShadow=!0,r.add(t)},void 0,function(e){console.log("error loader texture")});var t=Math.floor(Math.random()*J*J);(_=new O(P,H,"",3,0,t,x)).speed=120;var n=e.load("./texture/FinalLine.png");L=new i.Mesh(new i.PlaneGeometry(50,50),new i.MeshBasicMaterial({map:n,transparent:!0,side:i.DoubleSide})),A=t,L.position.copy(P.getNodeToPos(A)),L.position.y=5,L.rotation.x=-Math.PI/2,r.add(L),r.fog=new i.Fog(2236962,500,550)}(),re()})}]);
//# sourceMappingURL=main.bundle.js.map